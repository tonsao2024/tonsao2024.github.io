<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</title>
  <style>
    body { font-family: 'Sarabun', sans-serif; padding: 20px; max-width: 400px; margin: auto; background-color: #f4f4f9;}
    input, button { width: 100%; padding: 10px; margin: 8px 0; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc;}
    button { background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 16px; font-weight: bold;}
    button.load-btn { background-color: #2196F3; }
    button.logout-btn { background-color: #f44336; margin-top: 20px;}
    .box { background: white; border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
    #status { font-weight: bold; text-align: center; }
  </style>
</head>
<body>

  <div id="loginSection" class="box">
    <h2 style="text-align: center;">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
    <input type="email" id="loginEmail" placeholder="admin@example.com">
    <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</label>
    <input type="password" id="loginPassword" placeholder="******">
    <button onclick="login()">üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <p id="loginStatus" style="color: red; text-align: center; font-size: 14px;"></p>
  </div>

  <div id="appSection" style="display: none;">
    <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>

    <div class="box">
      <label><b>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</b> (‡πÉ‡∏™‡πà ID ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</label>
      <input type="text" id="recordId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 17090000 (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)">
      <button class="load-btn" onclick="loadData()">üîç ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <div class="box">
      <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
      <input type="text" id="name" required>
      <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
      <input type="email" id="email" required>
      <button onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <p id="status"></p>
    <button class="logout-btn" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>

  <script type="module">
    // ‡πÇ‡∏´‡∏•‡∏î Library ‡πÄ‡∏û‡∏¥‡πà‡∏° (Auth)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    // üî¥ 1. ‡∏ß‡∏≤‡∏á firebaseConfig ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üî¥
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÅ‡∏•‡∏∞ Auth
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const loginSection = document.getElementById("loginSection");
    const appSection = document.getElementById("appSection");
    const statusEl = document.getElementById("status");

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤ Login ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß -> ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ Form
        loginSection.style.display = "none";
        appSection.style.display = "block";
      } else {
        // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô -> ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Form
        loginSection.style.display = "block";
        appSection.style.display = "none";
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
    window.login = async function() {
      const email = document.getElementById("loginEmail").value;
      const pass = document.getElementById("loginPassword").value;
      const loginStatus = document.getElementById("loginStatus");
      
      loginStatus.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        loginStatus.innerText = "";
      } catch (error) {
        loginStatus.innerText = "‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
      }
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    window.logout = function() {
      signOut(auth);
      document.getElementById("status").innerText = "";
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.saveData = async function() {
      statusEl.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
      statusEl.style.color = "orange";
      let id = document.getElementById("recordId").value || new Date().getTime().toString(); 
      document.getElementById("recordId").value = id;

      try {
        await set(ref(db, 'users/' + id), {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          lastUpdate: new Date().toLocaleString("th-TH")
        });
        statusEl.innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (ID: " + id + ")";
        statusEl.style.color = "green";
      } catch (error) {
        statusEl.innerText = "‚ùå ‡∏û‡∏•‡∏≤‡∏î: " + error.message;
      }
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.loadData = async function() {
      const id = document.getElementById("recordId").value;
      if (!id) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà ID");

      statusEl.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
      try {
        const snapshot = await get(child(ref(db), `users/${id}`));
        if (snapshot.exists()) {
          document.getElementById("name").value = snapshot.val().name;
          document.getElementById("email").value = snapshot.val().email;
          statusEl.innerText = "‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
          statusEl.style.color = "blue";
        } else {
          statusEl.innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID ‡∏ô‡∏µ‡πâ";
        }
      } catch (error) {
        statusEl.innerText = "‚ùå ‡∏û‡∏•‡∏≤‡∏î: " + error.message;
      }
    };
  </script>
</body>
</html>