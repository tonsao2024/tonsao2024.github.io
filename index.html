<!DOCTYPE html>
<html lang="th">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- SweetAlert2 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Popup ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- SheetJS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* =======================================================
       Theme Variables (Light & Dark Mode)
       ======================================================= */
    :root {
      font-size: 16px; 
      --primary: #973122;         
      --primary-hover: #7a271b;
      --secondary: #64748b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #0ea5e9;
      --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05); 
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      --radius-md: 0.75rem; 
      --radius-lg: 1rem;
      
      --bg-body: #f8fafc; 
      --bg-surface: #ffffff; 
      --border-light: #e2e8f0; 
      --text-dark: #0f172a; 
      --text-muted: #64748b;
      --nav-bg: rgba(255, 255, 255, 0.95);
      --nav-text: #334155;
      --input-bg: #f1f5f9;
      --table-hover: #f1f5f9;
      --card-bg-subtle: #ffffff;
      --locked-bg: #e2e8f0;
      --locked-text: #94a3b8;
    }

    [data-theme="dark"] {
      --bg-body: #0f172a; 
      --bg-surface: #1e293b; 
      --border-light: #334155; 
      --text-dark: #f8fafc; 
      --text-muted: #cbd5e1;
      --nav-bg: rgba(15, 23, 42, 0.95);
      --nav-text: #f8fafc;
      --input-bg: #0b1120;
      --table-hover: #334155;
      --card-bg-subtle: #1e293b;
      --locked-bg: #111827;
      --locked-text: #475569;
    }

    body { background-color: var(--bg-body); font-family: 'Kanit', sans-serif; color: var(--text-dark); transition: background-color 0.3s, color 0.3s; }

    /* Fix Bootstrap backgrounds in Dark Mode */
    [data-theme="dark"] .bg-light, [data-theme="dark"] .bg-white { background-color: var(--bg-surface) !important; color: var(--text-dark) !important; }
    [data-theme="dark"] .text-dark { color: var(--text-dark) !important; }
    [data-theme="dark"] .card-header.bg-white { background-color: var(--bg-surface) !important; border-bottom: 1px solid var(--border-light); }
    [data-theme="dark"] .text-muted { color: var(--text-muted) !important; }
    [data-theme="dark"] .border-primary { border-color: var(--border-light) !important; }

    .page-content { display: none; opacity: 0; transition: opacity 0.3s ease; }
    .active-page { display: block; opacity: 1; animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Login Overlay */
    #loginOverlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--bg-body); z-index: 999999; display: flex; justify-content: center; align-items: center; }

    /* Navbar & Clock */
    .navbar { background: var(--nav-bg) !important; backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-light); box-shadow: var(--shadow-sm); padding: 0.5rem 0; transition: background 0.3s; }
    .navbar-brand { font-weight: 700; color: var(--primary) !important; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .navbar-brand img { height: 45px; object-fit: contain; }
    .nav-link { font-weight: 500; color: var(--nav-text) !important; padding: 0.5rem 1rem !important; border-radius: 50px; transition: all 0.2s; margin: 0 0.2rem; cursor: pointer;}
    .nav-link:hover, .nav-link.active { background: var(--border-light); color: var(--primary) !important; }
    
    .live-clock { font-size: 0.95rem; font-weight: 600; color: var(--primary); background: transparent; border: none; padding: 0.4rem 1rem; letter-spacing: 0.5px; }
    [data-theme="dark"] .live-clock { color: #f8fafc; }

    .theme-toggle { cursor: pointer; padding: 0.4rem; border-radius: 50%; background: var(--bg-surface); border: 1px solid var(--border-light); color: var(--text-dark); transition: 0.3s; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; font-size: 1.2rem; box-shadow: var(--shadow-sm); }
    
    /* Zoom & Scroll Controls */
    .zoom-controls { position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 8px; }
    .zoom-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--primary); color: #ffffff !important; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-size: 1.2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; font-weight: bold;}
    .zoom-btn:hover { background: var(--primary-hover); transform: scale(1.05); }

    .swal2-container { z-index: 99999 !important; font-family: 'Kanit', sans-serif; }

    /* Cards & Forms */
    .card { border: 1px solid var(--border-light); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); background: var(--bg-surface); margin-bottom: 1.5rem; transition: background 0.3s, border 0.3s; }
    .card-header { background: transparent; border-bottom: 1px solid var(--border-light); padding: 1.25rem 1.5rem; }
    .card-title-ui { font-weight: 600; color: var(--text-dark); font-size: 1.25rem; margin: 0; }
    .card-body { padding: 1.5rem; }

    label { font-weight: 500; color: var(--secondary); font-size: 0.95rem; margin-bottom: 0.3rem; }
    .form-control, .form-select { background-color: var(--input-bg); border: 1px solid var(--border-light); border-radius: var(--radius-md); padding: 0.6rem 1rem; color: var(--text-dark); transition: all 0.2s; }
    .form-control:focus, .form-select:focus { background-color: var(--bg-surface); border-color: var(--primary); box-shadow: 0 0 0 4px rgba(151, 49, 34, 0.15); color: var(--text-dark); }
    [data-theme="dark"] .form-select option { background-color: var(--bg-surface); color: var(--text-dark); }
    [data-theme="dark"] .form-control::placeholder { color: #64748b; }
    [data-theme="dark"] .modal-content { background-color: var(--bg-surface); color: var(--text-dark); border-color: var(--border-light); }
    [data-theme="dark"] .modal-header { border-bottom-color: var(--border-light); }
    [data-theme="dark"] .modal-footer { border-top-color: var(--border-light); }

    .input-group-text { background-color: var(--border-light); color: var(--secondary); border: 1px solid var(--border-light); }
    [data-theme="dark"] .input-group-text { background-color: var(--border-light); color: var(--text-dark); border-color: var(--border-light); }

    .radio-group-box { background: var(--input-bg); border: 1px solid var(--border-light); border-radius: var(--radius-md); padding: 1rem; height: 100%; transition: all 0.2s; }
    .group-title { font-weight: 600; color: var(--text-dark); font-size: 0.95rem; border-bottom: 1px solid var(--border-light); padding-bottom: 0.5rem; margin-bottom: 0.8rem; }
    .form-check { padding: 0.5rem 0.5rem 0.5rem 2rem; border-radius: 6px; transition: background 0.2s; margin-bottom: 2px; }
    .form-check:hover { background: rgba(151, 49, 34, 0.05); }
    [data-theme="dark"] .form-check:hover { background: var(--table-hover); }
    .tablet-radio { transform: scale(1.3); margin-top: 0.3rem; cursor: pointer; accent-color: var(--primary); }
    .radio-label { font-size: 1rem; cursor: pointer; display: inline-block; width: 100%; color: var(--text-dark); }
    
    .btn { border-radius: var(--radius-md); font-weight: 500; padding: 0.6rem 1.2rem; transition: all 0.2s; border: none; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(151, 49, 34, 0.3); color: white;}
    .btn-outline-primary { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
    .btn-outline-primary:hover { background: var(--primary); color: white; }
    .btn-outline-secondary { border: 1px solid var(--border-light); color: var(--text-dark); background: var(--bg-surface); }
    .btn-outline-secondary:hover { background: var(--border-light); color: var(--text-dark); }
    .btn-outline-danger { border: 1px solid var(--danger); color: var(--danger); background: transparent; }
    .btn-outline-danger:hover { background: var(--danger); color: white; }
    
    .group-cat-box { border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; background: var(--card-bg-subtle); box-shadow: var(--shadow-sm); }
    .observation-item { border: 1px solid var(--border-light); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 1rem; background: var(--bg-surface); }
    .obs-title { font-size: 1.05rem; font-weight: 600; color: var(--primary); margin-bottom: 0.8rem; }
    
    .sig-preview { border: 2px dashed var(--border-light); border-radius: var(--radius-md); background: var(--input-bg); height: 80px; width: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; }
    .sig-preview img { max-height: 100%; max-width: 100%; object-fit: contain; }
    .modal-canvas-wrap { border: 2px solid var(--primary); border-radius: 8px; background: #fff; touch-action: none; position: relative; }

    /* Tables */
    .table-responsive { background: var(--bg-surface); border-radius: var(--radius-lg); border: 1px solid var(--border-light); box-shadow: var(--shadow-sm); padding: 0 1rem; overflow-x: auto;}
    .table { margin-bottom: 0; width: 100%; color: var(--text-dark); }
    .table th { background-color: var(--bg-surface) !important; color: var(--secondary); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-bottom: 2px solid var(--border-light); }
    .table td { background: var(--bg-surface); border-top: 1px solid var(--border-light); border-bottom: 1px solid var(--border-light); padding: 1rem 0.5rem; vertical-align: middle; white-space: nowrap; color: var(--text-dark); transition: all 0.3s;}
    .table tbody tr:hover td { background-color: var(--table-hover); }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ (‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ñ‡∏ö ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ) */
    .row-locked td { background-color: var(--locked-bg) !important; color: var(--locked-text) !important; opacity: 0.8; }
    .row-locked .action-btn-edit, .row-locked .action-btn-del { opacity: 0.4; cursor: not-allowed !important; pointer-events: none; filter: grayscale(100%); }
    
    .action-btn { padding: 0.3rem 0.6rem; font-size: 1rem; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; }

    /* KPI Cards (Dashboard) */
    .kpi-card { background: var(--bg-surface); border-radius: var(--radius-lg); padding: 1.5rem; border: 1px solid var(--border-light); border-left: 5px solid var(--primary); box-shadow: var(--shadow-sm); position: relative; overflow: hidden; transition: 0.3s; }
    .kpi-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
    .kpi-title { font-size: 0.85rem; color: var(--secondary); font-weight: 600; text-transform: uppercase; margin-bottom: 0.5rem; z-index: 1; position: relative;}
    .kpi-value { font-size: 2.2rem; font-weight: 700; color: var(--text-dark); line-height: 1; z-index: 1; position: relative;}
    .kpi-icon { position: absolute; right: -10px; bottom: -10px; font-size: 4rem; opacity: 0.1; z-index: 0; }
    
    .dash-obs-table th { background-color: var(--primary); color: white; padding: 12px 10px; font-size: 0.95rem; border: 1px solid var(--border-light); white-space: nowrap; cursor: pointer; user-select: none;}
    .dash-obs-table th:hover { background-color: var(--primary-hover); }
    .dash-obs-table td { padding: 12px 10px; font-size: 0.95rem; border: 1px solid var(--border-light); background: var(--bg-surface); color: var(--text-dark); white-space: normal; word-wrap: break-word;}

    .chart-filter-badge { display: inline-flex; align-items: center; gap: 8px; background: var(--warning); color: white; padding: 0.3rem 0.8rem; border-radius: 50px; font-size: 0.85rem; font-weight: bold; margin-bottom: 1rem;}
    .chart-filter-clear { cursor: pointer; font-weight: bold; }

    /* =======================================================
       Print CSS (Strictly Sarabun 10pt & Forces Light Mode)
       ======================================================= */
    .paper-a4 { background: white; width: 210mm; margin: 20px auto; padding: 15mm 20mm; box-shadow: 0 0 20px rgba(0,0,0,0.1); border-radius: 4px; color: #000; font-family: 'Sarabun', sans-serif !important; font-size: 10pt !important; line-height: 1.35; }
    .print-only { display: none; }
    
    @media print {
      :root { --bg-body: #fff; --bg-surface: #fff; --text-dark: #000; --border-light: #000; --primary: #000; --input-bg: #fff; }
      body { background: white; margin: 0; padding: 0; color: #000; }
      .navbar, .btn, .no-print, .card, .theme-toggle, .zoom-controls, footer, #loginOverlay { display: none !important; }
      .page-content { display: block !important; }
      #page1, #page2, #page3 { display: none !important; } 
      #page4 { display: block !important; margin: 0; padding: 0; }
      .paper-a4 { box-shadow: none; border: none; width: 100%; margin: 0; padding: 0; color: #000;}
      .paper-a4 * { font-family: 'Sarabun', sans-serif !important; font-size: 10pt; color: #000 !important; }
      .print-only { display: block !important; }
      .page-break { page-break-before: always; padding-top: 10px; }
      @page { size: A4; margin: 15mm 12mm; }
    }

    .p-font { font-family: 'Sarabun', sans-serif !important; }
    .p-title-box { display: flex; justify-content: space-between; border: 1px solid #000; padding: 4px 8px; background: #e9ecef !important; font-weight: bold; font-size: 11pt; margin-bottom: 10px; align-items: center;}
    .p-head-text { text-align: center; font-weight: bold; font-size: 12pt; line-height: 1.3; margin-bottom: 10px; }
    .p-obj-box { font-size: 10pt; margin-bottom: 10px; line-height: 1.4; }
    .p-line { border-bottom: 1px dotted #000; display: inline-block; text-align: center; color: blue !important; min-height: 16px; }
    .p-row { display: flex; align-items: baseline; margin-bottom: 4px; }
    .p-row-grow { flex-grow: 1; }
    .p-check { font-family: 'Arial Unicode MS', 'Sarabun', sans-serif !important; font-size: 12pt; color: #000; line-height: 1; margin-right: 2px; }
    .p-section-title { font-weight: bold; background: #e9ecef !important; padding: 2px 10px; border-top: 2px solid #000; border-bottom: 2px solid #000; margin: 10px 0; font-size: 11pt; }
    .p-sub-title { text-decoration: underline; font-weight: bold; margin-bottom: 4px; margin-top: 8px; }
    .p-table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 10pt; }
    .p-table th, .p-table td { border: 1px solid #000; padding: 4px 6px; vertical-align: top; }
    .p-table th { text-align: center; background: #f8f9fa !important; font-weight: bold; }
    .p-sig-box { text-align: center; margin-bottom: 20px; page-break-inside: avoid; }
    .p-sig-img { width: 160px; height: 50px; margin: 0 auto; display: block; object-fit: contain; }
    .p-dotted-area { border-bottom: 1px dotted #000; height: 25px; width: 100%; color: blue !important; padding-left: 10px; box-sizing: border-box; }
  </style>
</head>
<body>

  <!-- Login Overlay -->
  <div id="loginOverlay">
    <div class="card shadow-lg p-4" style="width: 100%; max-width: 400px; border: 2px solid var(--primary);">
        <div class="text-center mb-4">
            <img src="https://www.audit.go.th/sites/default/files/logoSAO-BW-TH-s.png" alt="Logo" style="height: 60px; object-fit:contain;">
            <h4 class="fw-bold mt-3 text-primary">‡∏£‡∏∞‡∏ö‡∏ö DOP 5-1.1</h4>
            <p class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        </div>
        <input type="email" id="loginUser" class="form-control mb-3" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email)">
        <input type="password" id="loginPass" class="form-control mb-4" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)" onkeypress="if(event.key === 'Enter') window.doLogin()">
        <button class="btn btn-primary w-100 fw-bold py-2" onclick="window.doLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <!-- Zoom & Scroll Controls -->
  <div class="zoom-controls no-print">
    <button id="scrollTopBtn" class="zoom-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ö‡∏ô‡∏™‡∏∏‡∏î" style="display:none; background: var(--secondary);">‚¨ÜÔ∏è</button>
    <button class="zoom-btn" onclick="window.zoomIn()" title="‡∏Ç‡∏¢‡∏≤‡∏¢">‚ûï</button>
    <button class="zoom-btn" onclick="window.zoomReset()" title="‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥" style="font-size: 1rem;">O</button>
    <button class="zoom-btn" onclick="window.zoomOut()" title="‡∏¢‡πà‡∏≠">‚ûñ</button>
  </div>

  <!-- Top Navigation -->
  <nav class="navbar navbar-expand-lg sticky-top no-print">
    <div class="container-fluid px-4">
      <a class="navbar-brand" onclick="window.showPage('page1')">
        <img src="https://www.audit.go.th/sites/default/files/logoSAO-BW-TH-s.png" alt="Logo">
        ‡∏£‡∏∞‡∏ö‡∏ö DOP 5-1.1
      </a>
      
      <div class="d-flex align-items-center gap-2">
        <div class="live-clock d-none d-md-block" id="liveClock">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤...</div>
        
        <div class="navbar-nav flex-row gap-1 ms-3">
          <a class="nav-link" onclick="window.showPage('page1')">üìä ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
          <a class="nav-link" onclick="window.showPage('page2')">üìà ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
          <a class="nav-link bg-primary text-white fw-bold rounded-pill px-3 ms-2 shadow-sm" onclick="window.resetForm()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</a>
          <a class="nav-link text-danger fw-bold ms-2" onclick="window.doLogout()"><span style="cursor: pointer;">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span></a>
        </div>

        <div class="theme-toggle ms-3 shadow-sm" onclick="window.toggleTheme()" id="themeIcon" title="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠">üåô</div>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-4 mb-4" style="max-width: 1300px; min-height: 80vh;">
    
    <!-- ================= ‡∏´‡∏ô‡πâ‡∏≤ 1: ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏° ================= -->
    <div id="page1" class="page-content active-page">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <h3 class="fw-bold m-0 text-dark">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h3>
        <div class="mt-2 mt-md-0 d-flex gap-2">
          <button class="btn btn-outline-secondary shadow-sm fw-bold" onclick="window.loadTableData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-4 mb-2"><select id="filterProv" class="form-select border-primary shadow-sm" onchange="window.filterTable()"><option value="">üìç ‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option></select></div>
        <div class="col-md-4 mb-2"><select id="filterDist" class="form-select border-primary shadow-sm" onchange="window.filterTable()"><option value="">üìç ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</option></select></div>
        <div class="col-md-4 mb-2"><select id="filterGov" class="form-select border-primary shadow-sm" onchange="window.filterTable()"><option value="">üèõÔ∏è ‡∏ó‡∏∏‡∏Å ‡∏≠‡∏õ‡∏ó.</option></select></div>
      </div>

      <div class="table-responsive py-2 border-0 shadow-none bg-transparent px-0">
        <table class="table shadow-sm">
          <thead>
            <tr>
              <th onclick="window.sortTable('recordId')">ID <span id="sort_recordId"></span></th>
              <th onclick="window.sortTable('timestamp')">‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å <span id="sort_timestamp"></span></th>
              <th onclick="window.sortTable('obsDate')">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà <span id="sort_obsDate"></span></th>
              <th onclick="window.sortTable('localGov')">‡∏≠‡∏õ‡∏ó. <span id="sort_localGov"></span></th>
              <th onclick="window.sortTable('district')">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <span id="sort_district"></span></th>
              <th onclick="window.sortTable('province')">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span id="sort_province"></span></th>
              <th onclick="window.sortTable('elderlyName')">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ <span id="sort_elderlyName"></span></th>
              <th class="text-center" style="min-width: 140px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="dataTableBody">
            <tr><td colspan="8" class="text-center py-5 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‚è≥</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ================= ‡∏´‡∏ô‡πâ‡∏≤ 2: ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î ================= -->
    <div id="page2" class="page-content">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-dark m-0">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå</h3>
        <button class="btn btn-outline-secondary shadow-sm fw-bold" onclick="window.loadDashboardData()">üîÑ ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
      </div>

      <!-- Advanced Filters -->
      <div class="card border-0 shadow-sm mb-4 bg-body">
        <div class="card-body">
          <h6 class="fw-bold text-primary mb-3">üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h6>
          <div class="row g-2">
            <div class="col-md-3"><select id="dProv" class="form-select border-primary" onchange="window.updateDashFilters('prov')"><option value="">-- ‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option></select></div>
            <div class="col-md-3"><select id="dDist" class="form-select border-primary" onchange="window.updateDashFilters('dist')"><option value="">-- ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option></select></div>
            <div class="col-md-3"><select id="dGov" class="form-select border-primary" onchange="window.updateDashFilters('gov')"><option value="">-- ‡∏ó‡∏∏‡∏Å ‡∏≠‡∏õ‡∏ó. --</option></select></div>
            <div class="col-md-3"><select id="dName" class="form-select border-danger" style="border-width: 2px;" onchange="window.renderDashResult()"><option value="">-- ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option></select></div>
          </div>
        </div>
      </div>

      <div id="dashResult" style="display:none;">
        
        <!-- Active Interactive Filter Indicator -->
        <div id="chartFilterIndicator" style="display:none;">
            <div class="chart-filter-badge shadow-sm">
                <span>üéØ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Å‡∏£‡∏≤‡∏ü: <span id="chartFilterText"></span></span>
                <span class="chart-filter-clear ms-2" onclick="window.clearChartFilter()">‚úñ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</span>
            </div>
        </div>

        <!-- 5 KPI Cards -->
        <div class="row g-3 mb-4">
          <div class="col-md">
             <div class="kpi-card" style="border-left-color: var(--primary);">
                <div class="kpi-icon">üìã</div>
                <div class="kpi-title" id="txtKpi1">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÅ‡∏´‡πà‡∏á)</div>
                <div class="kpi-value text-primary" id="resTotal">0</div>
             </div>
          </div>
          <div class="col-md">
             <div class="kpi-card" style="border-left-color: var(--info);">
                <div class="kpi-icon">üèõÔ∏è</div>
                <div class="kpi-title">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏≠‡∏õ‡∏ó. (‡πÅ‡∏´‡πà‡∏á)</div>
                <div class="kpi-value text-info" id="resGovCount">0</div>
             </div>
          </div>
          <div class="col-md">
             <div class="kpi-card" style="border-left-color: var(--success);">
                <div class="kpi-icon">üí∞</div>
                <div class="kpi-title">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
                <div class="kpi-value text-success" id="resBudget">0</div>
             </div>
          </div>
          <div class="col-md">
             <div class="kpi-card" style="border-left-color: var(--warning);">
                <div class="kpi-icon">üë¥</div>
                <div class="kpi-title" id="txtKpiAge">‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏õ‡∏µ)</div>
                <div class="kpi-value text-warning" id="resAge">0</div>
             </div>
          </div>
          <div class="col-md">
             <div class="kpi-card" style="border-left-color: #8b5cf6;">
                <div class="kpi-icon">‚≠ê</div>
                <div class="kpi-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (%)</div>
                <div class="kpi-value" style="color: #8b5cf6;" id="resAppRate">0%</div>
             </div>
          </div>
        </div>

        <!-- Charts Row 1: Donut & Bar -->
        <div id="dashCharts" class="row g-4 mb-4">
          <div class="col-md-4">
            <div class="card h-100 shadow-sm">
               <div class="card-header bg-white"><h6 class="fw-bold text-dark m-0">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á)</h6></div>
               <div class="card-body d-flex justify-content-center align-items-center"><div style="width: 90%;"><canvas id="chApprop"></canvas></div></div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card h-100 shadow-sm">
               <div class="card-header bg-white"><h6 class="fw-bold text-dark m-0">‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î)</h6></div>
               <div class="card-body"><canvas id="chCatApprop"></canvas></div>
            </div>
          </div>
        </div>

        <!-- Charts Row 2: Pivot Table & Condition -->
        <div class="row g-4 mb-4">
           <!-- Pivot / Data Table Section -->
           <div class="col-md-8">
               <div class="card h-100 shadow-sm border-0">
                  <div class="card-header bg-white d-flex flex-wrap justify-content-between align-items-center gap-3">
                     <h6 class="fw-bold text-primary m-0">üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á)</h6>
                     <div id="pivotControls" class="d-flex align-items-center gap-2">
                        <select id="pivotDim" class="form-select form-select-sm d-inline-block w-auto border-primary" onchange="window.renderDashResult()">
                          <option value="category">‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                          <option value="localGov">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö ‡∏≠‡∏õ‡∏ó.</option>
                          <option value="district">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</option>
                          <option value="province">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                        </select>
                        <button class="btn btn-sm btn-success fw-bold" onclick="window.exportPivotToExcel()">üì• Excel</button>
                     </div>
                  </div>
                  <div class="card-body p-0">
                    <div class="table-responsive border-0 shadow-none px-0 mb-0" style="max-height: 400px; overflow-y: auto;">
                      <table class="dash-obs-table w-100 m-0" id="pivotTableExport">
                        <thead id="resObsHead" style="position: sticky; top: 0; z-index: 1;"></thead>
                        <tbody id="resObsTable"></tbody>
                      </table>
                    </div>
                  </div>
               </div>
           </div>
           
           <div class="col-md-4">
            <div class="card h-100 shadow-sm">
               <div class="card-header bg-white"><h6 class="fw-bold text-dark m-0">‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</h6></div>
               <div class="card-body d-flex justify-content-center align-items-center"><div style="width: 90%;"><canvas id="chCond"></canvas></div></div>
            </div>
          </div>
        </div>

        <!-- Show Comments/Remarks when filtered to individual -->
        <div id="remarksSection" style="display:none;">
          <h5 class="fw-bold text-warning mb-3">üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h5>
          <div class="card shadow-sm"><div class="card-body" id="resRemarks"></div></div>
        </div>
      </div>
      
      <div id="dashEmpty" class="text-center py-5 text-muted"><h5>üëà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h5></div>
    </div>

    <!-- ================= ‡∏´‡∏ô‡πâ‡∏≤ 3: ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ================= -->
    <div id="page3" class="page-content">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
        <h3 class="fw-bold text-primary m-0" id="formTitle">‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
        <div class="d-flex flex-wrap gap-2">
           <button class="btn btn-outline-info fw-bold shadow-sm" onclick="window.previewPrint()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)</button>
           <button class="btn btn-outline-success fw-bold shadow-sm" onclick="window.exportSingleExcel()">üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)</button>
           <button class="btn btn-outline-primary fw-bold shadow-sm" onclick="window.saveData(false)">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏£‡πà‡∏≤‡∏á)</button>
           <button class="btn btn-primary fw-bold shadow-sm" onclick="window.saveData(true)">üñ®Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>
      </div>
      
      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 -->
      <div class="card border-primary">
        <div class="card-header bg-primary text-white"><h6 class="card-title-ui text-white m-0">üìù ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h6></div>
        <div class="card-body">
          <div class="row g-3 mb-4">
            <div class="col-md-2"><label>ID ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label><input type="text" class="form-control fw-bold text-primary border-primary" id="manualRecordId" placeholder="‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡∏£‡∏±‡∏ô Auto"></div>
            <div class="col-md-4"><label>‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏õ‡∏ó.</label><input type="text" class="form-control" id="localGov"></div>
            <div class="col-md-3"><label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ (‡∏≠‡∏õ‡∏ó.)</label><input type="text" class="form-control" id="govDistrict"></div>
            <div class="col-md-3"><label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏≠‡∏õ‡∏ó.)</label><input type="text" class="form-control" id="govProvince"></div>
            <div class="col-md-6"><label>‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå</label><input type="text" class="form-control" id="inspector1"></div>
            <div class="col-md-6"><label>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå</label><input type="text" class="form-control" id="inspector2"></div>
            <div class="col-md-4"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå</label><input type="date" class="form-control" id="obsDate"></div>
            <div class="col-md-4"><label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏ô.)</label><input type="time" class="form-control" id="timeStart"></div>
            <div class="col-md-4"><label>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡∏ô.)</label><input type="time" class="form-control" id="timeEnd"></div>
          </div>
          
          <h6 class="fw-bold text-primary border-bottom pb-2 mb-3 mt-4">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h6>
          <div class="row g-3 mb-4">
            <div class="col-md-3"><label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô</label><select class="form-select" id="supportAgency"><option value="‡∏û‡∏°‡∏à.">‡∏û‡∏°‡∏à.</option><option value="‡∏®‡∏û‡∏™.">‡∏®‡∏û‡∏™.</option><option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></div>
            <div class="col-md-3"><label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label><input type="text" class="form-control" id="budgetYear"></div>
            <div class="col-md-3"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input type="number" class="form-control" id="budgetAmount"></div>
            <div class="col-md-3"><label>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏±‡∏ö‡∏á‡∏ö</label><select class="form-select" id="historyCount"><option value="0">‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</option><option value="1">‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß</option></select></div>
            <div class="col-md-3"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏ö</label><input type="number" class="form-control" id="historyNum" value="0"></div>
          </div>

          <h6 class="fw-bold text-primary border-bottom pb-2 mb-3 mt-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</h6>
          <div class="row g-3 mb-4">
            <div class="col-md-6"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" class="form-control" id="elderlyName"></div>
            <div class="col-md-2"><label>‡∏≠‡∏≤‡∏¢‡∏∏</label><input type="number" class="form-control" id="age"></div>
            <div class="col-md-4"><label>‡πÄ‡∏û‡∏®</label><select class="form-select" id="gender"><option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option><option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option></select></div>
            <div class="col-md-2"><label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label><input type="text" class="form-control" id="houseNo"></div>
            <div class="col-md-2"><label>‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà</label><input type="text" class="form-control" id="moo"></div>
            <div class="col-md-3"><label>‡∏ï‡∏≥‡∏ö‡∏•</label><input type="text" class="form-control" id="subDistrict"></div>
            <div class="col-md-3"><label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label><input type="text" class="form-control" id="district"></div>
            <div class="col-md-2"><label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label><input type="text" class="form-control" id="province"></div>
            <div class="col-md-4"><label>‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö</label><select class="form-select" id="livingStatus"><option value="‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option><option value="‡∏Ñ‡∏π‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏Ñ‡∏π‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option><option value="‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß">‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</option></select></div>
            <div class="col-md-4"><label>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</label><select class="form-select" id="caregiver"><option value="‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•">‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</option><option value="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</option></select></div>
            <div class="col-md-4"><label>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ö‡πâ‡∏≤‡∏ô</label><select class="form-select" id="houseType"><option value="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option><option value="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô</option><option value="‡∏ó‡∏≤‡∏ß‡∏ô‡πå‡πÄ‡∏Æ‡∏≤‡∏™‡πå">‡∏ó‡∏≤‡∏ß‡∏ô‡πå‡πÄ‡∏Æ‡∏≤‡∏™‡πå</option><option value="‡∏ï‡∏∂‡∏Å‡πÅ‡∏ñ‡∏ß">‡∏ï‡∏∂‡∏Å‡πÅ‡∏ñ‡∏ß</option></select></div>
            <div class="col-md-12"><label>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß (‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô)</label><div class="d-flex gap-2"><input type="number" class="form-control" id="famTotal" placeholder="‡∏£‡∏ß‡∏°"><input type="number" class="form-control" id="famChild" placeholder="‡πÄ‡∏î‡πá‡∏Å"><input type="number" class="form-control" id="famElder" placeholder="‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏"><input type="number" class="form-control" id="famWorker" placeholder="‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô"></div></div>
            <div class="col-md-3"><label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</label><input type="number" class="form-control" id="elderlyIncome"></div>
            <div class="col-md-6"><label>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</label><input type="text" class="form-control" id="incomeSource" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏, ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏Å‡∏≤‡∏£"></div>
            <div class="col-md-3"><label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</label><input type="number" class="form-control" id="totalFamilyIncome"></div>
            <div class="col-md-12"><label>‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô</label><select class="form-select" id="landOwnership"><option value="‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏á">‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏á</option><option value="‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô/‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥">‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô/‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥</option><option value="‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</option></select></div>
          </div>

          <h6 class="fw-bold text-primary border-bottom pb-2 mb-3 mt-4">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á/‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</h6>
          <div class="row g-3 mb-4">
            <div class="col-md-12">
              <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠)</label>
              <div class="p-2 border rounded" style="background: var(--input-bg);">
                <div class="form-check form-check-inline"><input class="form-check-input chk-req" type="checkbox" value="‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô / ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤ / ‡∏ö‡∏±‡∏ô‡πÑ‡∏î"> <label class="form-check-label text-dark">‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô / ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤ / ‡∏ö‡∏±‡∏ô‡πÑ‡∏î</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input chk-req" type="checkbox" value="‡∏ù‡∏≤‡∏ö‡πâ‡∏≤‡∏ô / ‡∏õ‡∏£‡∏∞‡∏ï‡∏π / ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á / ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÑ‡∏ü / ‡∏õ‡∏•‡∏±‡∏Å‡πÑ‡∏ü / ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü)"> <label class="form-check-label text-dark">‡∏ù‡∏≤‡∏ö‡πâ‡∏≤‡∏ô/‡∏õ‡∏£‡∏∞‡∏ï‡∏π/‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á/‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input chk-req" type="checkbox" value="‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥"> <label class="form-check-label text-dark">‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input chk-req" type="checkbox" value="‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á / ‡∏ä‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô"> <label class="form-check-label text-dark">‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á / ‡∏ä‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</label></div>
                <div class="form-check form-check-inline"><input class="form-check-input chk-req" type="checkbox" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ"> <label class="form-check-label text-dark">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label> <input type="text" class="form-control form-control-sm d-inline w-auto ms-2" id="reqOtherText"></div>
              </div>
            </div>
            <div class="col-md-12"><label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö)</label><textarea class="form-control" id="receivedItems" rows="2"></textarea></div>
            <div class="col-md-4"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à</label><input type="date" class="form-control" id="finishDate"></div>
            <div class="col-md-4"><label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</label><div class="d-flex gap-2"><input type="number" class="form-control" id="durYear" placeholder="‡∏õ‡∏µ"><input type="number" class="form-control" id="durMonth" placeholder="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"></div></div>
            <div class="col-md-4"><label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢</label><input type="text" class="form-control" id="otherAgency" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></div>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
             <label class="fw-bold text-primary m-0">‡∏™‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏° (‡∏ï‡∏≤‡∏£‡∏≤‡∏á 1-6)</label>
             <button class="btn btn-sm btn-outline-primary fw-bold" onclick="window.addRepairRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</button>
          </div>
          <div class="table-responsive border-0 px-0 shadow-none">
            <table class="table table-bordered mb-0">
              <thead class="bg-light"><tr><th style="width:30%">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th><th style="width:45%">‡∏™‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</th><th style="width:20%">‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠</th><th style="width:5%"></th></tr></thead>
              <tbody id="repairTbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 -->
      <div class="card mb-4" style="border-top: 4px solid var(--success);">
        <div class="card-header"><h6 class="card-title-ui text-success m-0">üîç ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢ <span class="text-danger fs-6">(‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô)</span></h6></div>
        <div class="card-body bg-body">
          <div id="observationContainer"></div>
          <div class="text-center mt-3"><button class="btn btn-outline-secondary rounded-pill px-4 shadow-sm" style="background:var(--bg-surface)" onclick="window.addOtherItem()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ</button></div>
        </div>
      </div>

      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 -->
      <div class="card mb-4" style="border-top: 4px solid var(--danger);">
        <div class="card-header"><h6 class="card-title-ui text-danger m-0">‚úçÔ∏è ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</h6></div>
        <div class="card-body">
          <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</label>
          <textarea class="form-control mb-4" id="inspectorSummary" rows="4"></textarea>
          
          <div class="row g-4">
            <div class="col-md-6 border-end p-3">
              <label class="text-primary fw-bold">1. ‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå</label>
              <input type="text" class="form-control mb-2" id="s1_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
              <input type="text" class="form-control mb-2" id="s1_pos" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
              <input type="text" class="form-control mb-2" id="s1_agency" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô">
              <div class="sig-preview shadow-sm" onclick="window.openSigModal('pad1', '‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå')">
                <img id="img_pad1" src="" alt="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠" onerror="this.style.display='none'; this.parentNode.innerHTML='<span class=\'text-muted fw-bold\'>‚úçÔ∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</span><img id=\'img_pad1\' src=\'\' style=\'display:none;\'>'">
              </div>
            </div>
            <div class="col-md-6 p-3">
              <label class="text-primary fw-bold">2. ‡∏™‡∏ï‡∏á. (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô)</label>
              <input type="text" class="form-control mb-2" id="s2_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
              <div class="input-group mb-2">
                 <span class="input-group-text" style="font-size: 0.85rem;">‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô</span>
                 <input type="text" class="form-control" id="s2_pos" placeholder="‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£/‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£">
              </div>
              <input type="text" class="form-control mb-2" value="‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô" disabled>
              <div class="sig-preview shadow-sm" onclick="window.openSigModal('pad2', '‡∏™‡∏ï‡∏á. (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô)')">
                <img id="img_pad2" src="" alt="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠" onerror="this.style.display='none'; this.parentNode.innerHTML='<span class=\'text-muted fw-bold\'>‚úçÔ∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</span><img id=\'img_pad2\' src=\'\' style=\'display:none;\'>'">
              </div>
            </div>
            <div class="col-md-6 border-end border-top p-3">
              <label class="text-primary fw-bold">3. ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå</label>
              <input type="text" class="form-control mb-2" id="s3_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
              <input type="text" class="form-control mb-2" id="s3_pos" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
              <input type="text" class="form-control mb-2" id="s3_agency" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô">
              <div class="sig-preview shadow-sm" onclick="window.openSigModal('pad3', '‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå')">
                <img id="img_pad3" src="" alt="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠" onerror="this.style.display='none'; this.parentNode.innerHTML='<span class=\'text-muted fw-bold\'>‚úçÔ∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</span><img id=\'img_pad3\' src=\'\' style=\'display:none;\'>'">
              </div>
            </div>
            <div class="col-md-6 border-top p-3">
              <label class="text-primary fw-bold">4. ‡∏™‡∏ï‡∏á. (‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á)</label>
              <input type="text" class="form-control mb-2" id="s4_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
              <div class="input-group mb-2">
                 <span class="input-group-text" style="font-size: 0.85rem;">‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô</span>
                 <input type="text" class="form-control" id="s4_pos" placeholder="‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£/‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£">
              </div>
              <input type="text" class="form-control mb-2" value="‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô" disabled>
              <div class="sig-preview shadow-sm" onclick="window.openSigModal('pad4', '‡∏™‡∏ï‡∏á. (‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á)')">
                <img id="img_pad4" src="" alt="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠" onerror="this.style.display='none'; this.parentNode.innerHTML='<span class=\'text-muted fw-bold\'>‚úçÔ∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</span><img id=\'img_pad4\' src=\'\' style=\'display:none;\'>'">
              </div>
            </div>
          </div>
          
          <div class="mt-4 d-flex flex-wrap gap-2">
            <button class="btn btn-outline-info fw-bold shadow-sm" onclick="window.previewPrint()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)</button>
            <button class="btn btn-outline-success fw-bold shadow-sm" onclick="window.exportSingleExcel()">üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)</button>
            <button class="btn btn-outline-primary fw-bold shadow-sm" onclick="window.saveData(false)">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏£‡πà‡∏≤‡∏á)</button>
            <button class="btn btn-primary fw-bold shadow-sm" onclick="window.saveData(true)">üñ®Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
          </div>
        </div>
      </div>
    </div>


    <!-- ================= ‡∏´‡∏ô‡πâ‡∏≤ 4: ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏û‡∏¥‡∏°‡∏û‡πå ================= -->
    <div id="page4" class="page-content">
      <div class="text-center mb-4 no-print bg-white p-4 rounded shadow-sm border border-primary">
        <p class="text-success fw-bold mb-3 fs-5">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡πâ‡∏ß (‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢)</p>
        <button class="btn btn-success px-5 shadow-sm" onclick="window.print()">üñ®Ô∏è ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
        <button class="btn btn-outline-secondary ms-2" onclick="window.showPage('page3')">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </div>

      <!-- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà 1 -->
      <div class="paper-a4 p-font" id="printSection1">
        <div class="p-title-box">
          <div><img src="https://www.audit.go.th/sites/default/files/logoSAO-BW-TH-s.png" style="height: 1.2em; vertical-align: text-bottom; margin-right: 5px;">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô</div>
          <div>‡πÅ‡∏ö‡∏ö ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå DOP 5-1.1</div>
        </div>
        <div class="p-head-text">‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏Ø<br>‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏™‡∏π‡∏á‡∏ß‡∏±‡∏¢<br>‡∏Å‡∏£‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏Ç‡∏≠‡∏á‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå</div>
        <div class="p-obj-box"><b>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå :</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏≤‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏ï‡∏•‡∏≠‡∏î‡∏à‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î<br><b>‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• :</b> ‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>

        <div class="p-row">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô <span class="p-line p-row-grow" id="p_localGov"></span> ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠<span class="p-line" style="width:100px" id="p_gDist"></span>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î<span class="p-line" style="width:120px" id="p_gProv"></span></div>
        <div class="p-row">‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå <span class="p-line p-row-grow" id="p_insp1"></span></div>
        <div class="p-row">‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå <span class="p-line p-row-grow" id="p_insp2"></span></div>
        <div class="p-row">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå <span class="p-line" style="width:50px" id="p_d"></span> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <span class="p-line" style="width:120px" id="p_m"></span> ‡∏û.‡∏®. <span class="p-line" style="width:60px" id="p_y"></span> ‡πÄ‡∏ß‡∏•‡∏≤ <span class="p-line" style="width:60px" id="p_t1"></span> ‡∏ô. ‡∏ñ‡∏∂‡∏á <span class="p-line" style="width:60px" id="p_t2"></span> ‡∏ô.</div>

        <div class="p-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
        <div class="p-sub-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</div>
        <div class="p-row">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <span class="p-check" id="cb_a1">‚òê</span> ‡∏û‡∏°‡∏à. <span class="p-line" style="width:80px"></span> / <span class="p-check" id="cb_a2">‚òê</span> ‡∏®‡∏û‡∏™. <span class="p-line" style="width:80px"></span> / <span class="p-check" id="cb_a3">‚òê</span> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏) <span class="p-line" style="width:150px" id="p_agencyText"></span></div>
        <div class="p-row">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö <span class="p-line" style="width:100px" id="p_year"></span> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <span class="p-line p-row-grow" id="p_budget"></span> ‡∏ö‡∏≤‡∏ó</div>
        <div class="p-row">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_h1">‚òê</span> ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_h2">‚òê</span> ‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß <span class="p-line" style="width:50px" id="p_hist"></span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>

        <div class="p-sub-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</div>
        <div class="p-row">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏) <span class="p-line p-row-grow" id="p_name"></span></div>
        <div class="p-row">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà) ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà<span class="p-line" style="width:50px" id="p_house"></span>‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà<span class="p-line" style="width:40px" id="p_moo"></span>‡∏ï‡∏≥‡∏ö‡∏•<span class="p-line" style="width:100px" id="p_sub"></span>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠<span class="p-line" style="width:100px" id="p_dist"></span>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î<span class="p-line p-row-grow" id="p_prov"></span></div>
        
        <div class="p-row mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô) <span class="p-line" style="width:50px" id="p_age"></span> ‡∏õ‡∏µ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡πÄ‡∏û‡∏® &nbsp;&nbsp;<span class="p-check" id="cb_m">‚òê</span> ‡∏ä‡∏≤‡∏¢ &nbsp;&nbsp;<span class="p-check" id="cb_f">‚òê</span> ‡∏´‡∏ç‡∏¥‡∏á</div>
        <div class="p-row mt-1">‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_l1">‚òê</span> ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_l2">‚òê</span> ‡∏Ñ‡∏π‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_l3">‚òê</span> ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</div>
        <div class="p-row mt-1">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_c1">‚òê</span> ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_c2">‚òê</span> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</div>
        <div class="p-row mt-1">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ö‡πâ‡∏≤‡∏ô &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_ht1">‚òê</span> ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß <span class="p-check ms-3" id="cb_ht2">‚òê</span> ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô &nbsp;&nbsp;&nbsp; <span class="p-check ms-3" id="cb_ht3">‚òê</span> ‡∏ó‡∏≤‡∏ß‡∏ô‡πå‡πÄ‡∏Æ‡∏≤‡∏™‡πå &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check ms-3" id="cb_ht4">‚òê</span> ‡∏ï‡∏∂‡∏Å‡πÅ‡∏ñ‡∏ß</div>
        <div class="p-row mt-1">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß <span class="p-line" style="width:40px" id="p_f1"></span> ‡∏Ñ‡∏ô ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏î‡πá‡∏Å <span class="p-line" style="width:40px" id="p_f2"></span> ‡∏Ñ‡∏ô ‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ <span class="p-line" style="width:40px" id="p_f3"></span> ‡∏Ñ‡∏ô ‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô <span class="p-line" style="width:40px" id="p_f4"></span> ‡∏Ñ‡∏ô</div>
        <div class="p-row mt-1">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ <span class="p-line" style="width:80px" id="p_inc1"></span> ‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ &nbsp; <span class="p-check" id="cb_i1">‚òê</span> ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ <span class="p-check ms-2" id="cb_i2">‚òê</span> ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏Å‡∏≤‡∏£ <span class="p-check ms-2" id="cb_i3">‚òê</span> ‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏´‡πà‡∏á‡∏£‡∏±‡∏ê <span class="p-check ms-2" id="cb_i4">‚òê</span> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ <span class="p-line" style="width:100px" id="p_incSrc"></span></div>
        <div class="p-row mt-1">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) <span class="p-line" style="width:100px" id="p_inc2"></span> ‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
        <div class="p-row mt-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á &nbsp;&nbsp; <span class="p-check" id="cb_land1">‚òê</span> ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏á &nbsp;&nbsp; <span class="p-check" id="cb_land2">‚òê</span> ‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô/‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥ &nbsp;&nbsp; <span class="p-check" id="cb_land3">‚òê</span> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</div>

        <div class="p-sub-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠)</div>
        <div><span class="p-check" id="cb_rq1">‚òê</span> ‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô / ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤ / ‡∏ö‡∏±‡∏ô‡πÑ‡∏î</div>
        <div><span class="p-check" id="cb_rq2">‚òê</span> ‡∏ù‡∏≤‡∏ö‡πâ‡∏≤‡∏ô / ‡∏õ‡∏£‡∏∞‡∏ï‡∏π / ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á / ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÑ‡∏ü / ‡∏õ‡∏•‡∏±‡∏Å‡πÑ‡∏ü / ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü)</div>
        <div><span class="p-check" id="cb_rq3">‚òê</span> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥</div>
        <div class="p-row"><span class="p-check" id="cb_rq4">‚òê</span> ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á / ‡∏ä‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_rq5">‚òê</span> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏) <span class="p-line" style="width:200px" id="p_reqOther"></span></div>

        <div class="p-sub-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á/‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏° (‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö)</div>
        <div class="p-row">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á <span class="p-line p-row-grow" id="p_recItems1"></span></div>
        <div class="p-row"><span class="p-line p-row-grow" id="p_recItems2"></span></div>
        <div class="p-row mt-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="p-line" style="width:30px" id="p_fD"></span> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <span class="p-line" style="width:80px" id="p_fM"></span> ‡∏û.‡∏®. <span class="p-line" style="width:40px" id="p_fY"></span> ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á <span class="p-line" style="width:30px" id="p_dy"></span> ‡∏õ‡∏µ <span class="p-line" style="width:30px" id="p_dm"></span> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
        <div class="p-row mt-1">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô &nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_oa1">‚òê</span> ‡πÑ‡∏°‡πà‡∏°‡∏µ &nbsp;&nbsp;&nbsp; <span class="p-check" id="cb_oa2">‚òê</span> ‡∏°‡∏µ (‡∏£‡∏∞‡∏ö‡∏∏) <span class="p-line" style="width:150px" id="p_otherAgency"></span></div>
      </div>
      
      <!-- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà 2 -->
      <div class="page-break"></div>
      <div class="paper-a4 p-font">
        <div class="text-center mb-2">-2-</div>
        <div class="p-sub-title mb-2">‡∏™‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á/‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</div>
        <table class="p-table mb-3">
          <thead><tr><th style="width:30%">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</th><th style="width:45%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</th><th style="width:25%">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£/‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</th></tr></thead>
          <tbody id="p_repairTable"></tbody>
        </table>

        <div class="p-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏)</div>
        <table class="p-table">
          <thead><tr><th style="width:35%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö/<br>‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th><th style="width:15%">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</th><th style="width:25%">‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á<br>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á<br>(‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå)</th><th style="width:25%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</th></tr></thead>
          <tbody id="p_obsTable_p1"></tbody>
        </table>
      </div>

      <!-- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà 3 -->
      <div class="page-break"></div>
      <div class="paper-a4 p-font">
        <div class="text-center mb-2">-3-</div>
        <table class="p-table" style="margin-top:0;">
          <thead><tr><th style="width:35%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö/<br>‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th><th style="width:15%">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</th><th style="width:25%">‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á<br>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á<br>(‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå)</th><th style="width:25%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</th></tr></thead>
          <tbody id="p_obsTable_p2"></tbody>
        </table>
      </div>

      <!-- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà 4 -->
      <div class="page-break"></div>
      <div class="paper-a4 p-font">
        <div class="text-center mb-2">-4-</div>
        <table class="p-table" style="margin-top:0;">
          <thead><tr><th style="width:35%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö/<br>‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th><th style="width:15%">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</th><th style="width:25%">‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á<br>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á<br>(‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå)</th><th style="width:25%">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</th></tr></thead>
          <tbody id="p_obsTable_p3"></tbody>
        </table>

        <div class="mt-2 text-muted" style="font-size: 10pt;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ : ‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ "‡πÑ‡∏°‡πà‡∏°‡∏µ" ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div>

        <div class="signature-section mt-4">
          <div class="fw-bold">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô/‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
          <div class="p-dotted-area" id="p_comment1"></div>
          <div class="p-dotted-area" id="p_comment2"></div>
          <div class="p-dotted-area" id="p_comment3"></div>
          
          <div class="text-center mt-4 mb-4" style="font-style: italic;">*‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∂‡∏á‡∏•‡∏á‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô*</div>
          
          <div class="row" style="margin-top: 30px;">
            <div class="col-6 p-sig-box">
              <img id="img_pad1_out" class="print-only p-sig-img" alt="" />
              <div class="p-row justify-content-center mt-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <span class="p-line" style="width:180px;"></span></div>
              <div class="p-row justify-content-center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<span class="p-line" style="width:200px;" id="o_n1"></span>)</div>
              <div class="p-row justify-content-center mt-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span class="p-line" style="width:220px;" id="o_p1"></span></div>
              <div class="p-row justify-content-center mt-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="p-line" style="width:220px;" id="o_a1"></span></div>
            </div>
            <div class="col-6 p-sig-box">
              <img id="img_pad2_out" class="print-only p-sig-img" alt="" />
              <div class="p-row justify-content-center mt-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <span class="p-line" style="width:180px;"></span></div>
              <div class="p-row justify-content-center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<span class="p-line" style="width:200px;" id="o_n2"></span>)</div>
              <div class="p-row justify-content-center mt-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô <span class="p-line" style="width:70px;" id="o_p2"></span></div>
              <div class="p-row justify-content-center mt-1 text-start" style="padding-left: 30px;">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô</div>
            </div>
          </div>
          <div class="row" style="margin-top: 20px;">
            <div class="col-6 p-sig-box">
              <img id="img_pad3_out" class="print-only p-sig-img" alt="" />
              <div class="p-row justify-content-center mt-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <span class="p-line" style="width:180px;"></span></div>
              <div class="p-row justify-content-center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<span class="p-line" style="width:200px;" id="o_n3"></span>)</div>
              <div class="p-row justify-content-center mt-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span class="p-line" style="width:220px;" id="o_p3"></span></div>
              <div class="p-row justify-content-center mt-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="p-line" style="width:220px;" id="o_a3"></span></div>
            </div>
            <div class="col-6 p-sig-box">
              <img id="img_pad4_out" class="print-only p-sig-img" alt="" />
              <div class="p-row justify-content-center mt-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <span class="p-line" style="width:180px;"></span></div>
              <div class="p-row justify-content-center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<span class="p-line" style="width:200px;" id="o_n4"></span>)</div>
              <div class="p-row justify-content-center mt-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô <span class="p-line" style="width:70px;" id="o_p4"></span></div>
              <div class="p-row justify-content-center mt-1 text-start" style="padding-left: 30px;">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="container-fluid no-print">
       <footer class="text-center py-4 mt-4 border-top text-muted" style="font-size: 0.95rem;">
         ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡πÇ‡∏ä‡∏ï‡∏¥‡∏ò‡∏ô‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏£‡∏±‡∏ï‡∏ô‡∏ó‡∏¥‡∏û‡∏¢‡πå (‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£)
       </footer>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô -->
  <div class="modal fade" id="sigModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content border-primary shadow-lg">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title fw-bold" id="sigModalTitle">‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center bg-light">
          <div class="modal-canvas-wrap shadow-sm">
            <canvas id="modalCanvas" style="width:100%; height:300px; cursor:crosshair; touch-action: none; background:#fff;"></canvas>
          </div>
          <p class="text-danger mt-3 mb-0 fw-bold">‡πÉ‡∏ä‡πâ‡∏ô‡∏¥‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-outline-secondary fw-bold" onclick="window.clearModalSignature()">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
          <button type="button" class="btn btn-primary px-4 fw-bold shadow-sm" onclick="window.confirmSignature()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase & Core Logic -->
  <script type="module">
    // ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, doc, setDoc, getDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // üö® ‡∏ô‡∏≥ config ‡∏à‡∏≤‡∏Å Firebase Console ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üö®
    const firebaseConfig = {
      apiKey: "AIzaSyA5vDY5VUj2q1eQh7YEPSIgnLH-no3pyCk",
      authDomain: "survaydatsao.firebaseapp.com",
      databaseURL: "https://survaydatsao-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "survaydatsao",
      storageBucket: "survaydatsao.firebasestorage.app",
      messagingSenderId: "818178217120",
      appId: "1:818178217120:web:adabe4ae99b6ac6bd625c5",
      measurementId: "G-TCZ44ZDFD9"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global
    let globalTableData = []; let globalDashData = []; let isEditMode = false; let filteredTableData = []; let currentSortCol = ''; let currentSortAsc = true;
    let currentSigTarget = '';
    let dashCharts = { approp: null, cond: null, catApprop: null };
    let dashActiveFilter = null; 
    let repairRowCount = 0;
    
    // ==========================================
    // UI & Utility Functions
    // ==========================================
    window.addEventListener('scroll', () => { const topBtn = document.getElementById('scrollTopBtn'); if(window.scrollY > 300) topBtn.style.display = 'flex'; else topBtn.style.display = 'none'; });
    
    let currentRem = 16;
    window.zoomIn = () => { currentRem += 2; document.documentElement.style.fontSize = currentRem + 'px'; }
    window.zoomOut = () => { currentRem = Math.max(10, currentRem - 2); document.documentElement.style.fontSize = currentRem + 'px'; }
    window.zoomReset = () => { currentRem = 16; document.documentElement.style.fontSize = currentRem + 'px'; }

    function showLoader(titleText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...') {
      Swal.fire({
         title: titleText, html: '<div class="mt-3"><div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div></div>',
         showConfirmButton: false, allowOutsideClick: false, allowEscapeKey: false,
         background: document.documentElement.getAttribute('data-theme') === 'dark' ? '#1e293b' : '#ffffff',
         color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#f8fafc' : '#0f172a'
      });
    }
    function hideLoader() { if (Swal.isVisible()) Swal.close(); }
    function showToast(title, icon='success') { Swal.fire({ toast: true, position: 'top-end', icon: icon, title: title, showConfirmButton: false, timer: 2500 }); }

    // ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡πÅ‡∏ö‡∏ö‡∏™‡∏î
    function updateClock() {
      const now = new Date();
      document.getElementById('liveClock').textContent = now.toLocaleDateString('th-TH', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) + ' ‡∏ô.';
    }
    setInterval(updateClock, 1000); updateClock();

    window.toggleTheme = () => {
      const body = document.documentElement; const icon = document.getElementById('themeIcon');
      if (body.getAttribute('data-theme') === 'dark') { body.removeAttribute('data-theme'); icon.textContent = 'üåô'; } 
      else { body.setAttribute('data-theme', 'dark'); icon.textContent = '‚òÄÔ∏è'; }
    }

    window.showPage = (pageId) => {
      document.querySelectorAll('.page-content').forEach(el => el.classList.remove('active-page'));
      document.getElementById(pageId).classList.add('active-page');
      window.scrollTo(0,0);
    }

    function formatDateBE(dateStr) {
      if (!dateStr || dateStr === '-') return '-';
      const parts = dateStr.split('-');
      if (parts.length === 3) return `${parts[2]}/${parts[1]}/${parseInt(parts[0]) + 543}`;
      return dateStr;
    }
    
    function parseDateToISO(dateStr) {
      if (!dateStr || dateStr === '-') return '';
      if (dateStr.includes('-')) {
          let parts = dateStr.split('-');
          if(parts[0].length === 4 && parseInt(parts[0]) > 2500) return `${parseInt(parts[0]) - 543}-${parts[1]}-${parts[2]}`;
          return dateStr;
      } 
      const parts = dateStr.split('/');
      if (parts.length === 3) return `${parseInt(parts[2]) - 543}-${parts[1]}-${parts[0]}`;
      return '';
    }

    // ==========================================
    // Firebase Auth (Login / Logout)
    // ==========================================
    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById('loginOverlay').style.display = 'none';
        window.showPage('page1'); 
        window.loadTableData();
      } else {
        document.getElementById('loginOverlay').style.display = 'flex';
      }
    });

    window.doLogin = async () => {
        const email = document.getElementById('loginUser').value;
        const pass = document.getElementById('loginPass').value;
        if(!email || !pass) return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', 'warning');
        
        showLoader('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...');
        try {
            await signInWithEmailAndPassword(auth, email, pass);
            hideLoader();
            showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        } catch (error) {
            hideLoader();
            Swal.fire({icon: 'error', title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', text: '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'});
        }
    }

    window.doLogout = async () => {
        await signOut(auth);
        document.getElementById('loginUser').value = '';
        document.getElementById('loginPass').value = '';
    }

    // ==========================================
    // Firebase Database Functions (CRUD)
    // ==========================================
    
    // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏´‡∏ô‡πâ‡∏≤ 1)
    window.loadTableData = async (silent = false) => {
      if(!silent) showLoader('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase...');
      const tbody = document.getElementById('dataTableBody'); 

      try {
        const querySnapshot = await getDocs(collection(db, "observations"));
        let data = [];
        querySnapshot.forEach((doc) => { data.push({ docId: doc.id, ...doc.data().general, isLocked: doc.data().isLocked }); });
        
        if(!silent) hideLoader();
        globalTableData = data; filteredTableData = [...data];
        populateTableFilters(); renderTable(filteredTableData);
      } catch (err) {
        if(!silent) hideLoader();
        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î', err.message, 'error');
        tbody.innerHTML = `<tr><td colspan="8" class="text-center text-danger py-4">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}</td></tr>`;
      }
    }

    // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.saveData = async (doPrint) => {
      if (doPrint) {
        let missing = validateObservation();
        if(missing.length > 0) {
          Swal.fire({ title: '‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô!<br><br>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥:<br>' + missing.join("<br>"), icon: 'warning' });
          return;
        }
      }

      showLoader("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Firebase...");
      const payload = getFormData();

      try {
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ID ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ
        if (!payload.general.recordId) {
             const snap = await getDocs(collection(db, "observations"));
             let maxId = 0;
             snap.forEach(d => {
                 let idNum = parseInt(d.data().general.recordId);
                 if(!isNaN(idNum) && idNum > maxId) maxId = idNum;
             });
             payload.general.recordId = (maxId + 1).toString();
        }

        // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö
        const docData = {
            general: payload.general,
            observations: payload.observations,
            signames: payload.signames,
            signatures: payload.signatures,
            isLocked: false,
            updatedAt: new Date().toISOString()
        };

        // ‡πÉ‡∏ä‡πâ recordId ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠ Document ‡πÉ‡∏ô Firestore
        await setDoc(doc(db, "observations", payload.general.recordId), docData);
        
        hideLoader();
        if(doPrint) {
           populatePrintPage(payload.general, payload.signames, payload.observations, payload.signatures);
           showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); 
           window.showPage('page4'); 
        } else {
           Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', showConfirmButton: false, timer: 2000 });
           document.getElementById('manualRecordId').value = payload.general.recordId;
           document.getElementById('manualRecordId').readOnly = true;
           isEditMode = true;
        }
        window.loadTableData(true); 
      } catch(err) {
        hideLoader(); Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", err.message, 'error'); 
      }
    }

    // 3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    window.editRecord = async (docId) => {
      showLoader('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...');
      document.querySelectorAll('.sig-preview img').forEach(img => { img.src = ''; img.style.display = 'none'; img.parentElement.querySelector('span').style.display = 'inline';});

      try {
        const docSnap = await getDoc(doc(db, "observations", String(docId)));
        hideLoader();
        
        if (docSnap.exists()) {
            const record = docSnap.data();
            window.showPage('page3');
            isEditMode = true; document.getElementById('formTitle').innerText = `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (ID: #${docId})`;
            const g = record.general; 
            document.getElementById('manualRecordId').value = g.recordId; document.getElementById('manualRecordId').readOnly = true;
            
            ['localGov','govDistrict','govProvince','inspector1','inspector2','timeStart','timeEnd','supportAgency','budgetYear','budgetAmount','historyCount','elderlyName','age','houseNo','moo','subDistrict','district','province','livingStatus','caregiver','houseType','elderlyIncome','incomeSource','totalFamilyIncome','landOwnership','receivedItems','otherAgency','inspectorSummary'].forEach(key => { if(document.getElementById(key)) document.getElementById(key).value = g[key] || ''; });
            
            if(g.obsDate) document.getElementById('obsDate').value = parseDateToISO(g.obsDate);
            if(g.finishDate) document.getElementById('finishDate').value = parseDateToISO(g.finishDate);
            if(g.gender) document.querySelector(`select#gender`).value = g.gender;
            
            document.getElementById('famTotal').value = g.famTotal || ''; document.getElementById('famChild').value = g.famChild || ''; document.getElementById('famElder').value = g.famElder || ''; document.getElementById('famWorker').value = g.famWorker || ''; 
            document.getElementById('durYear').value = g.durYear || ''; document.getElementById('durMonth').value = g.durMonth || ''; 
            
            document.getElementById('repairTbody').innerHTML = ''; repairRowCount = 0;
            if(g.repairs && g.repairs.length > 0) { g.repairs.forEach(rep => window.addRepairRow(rep)); } else { for(let i=0; i<6; i++) window.addRepairRow(); }

            if(g.requestItems) { 
               const reqArr = g.requestItems.split(',').map(s=>s.trim()); 
               document.querySelectorAll('.chk-req').forEach(chk => { if(reqArr.some(r => r.includes(chk.value))) chk.checked = true; }); 
               document.getElementById('reqOtherText').value = extractOtherText(g.requestItems); 
            }
            
            const sn = record.signames; 
            document.getElementById('s1_name').value = (sn && sn.n1) ? sn.n1 : ''; 
            document.getElementById('s3_name').value = (sn && sn.n3) ? sn.n3 : ''; 
            document.getElementById('s2_pos').value = g.s2_pos || '';
            document.getElementById('s4_pos').value = g.s4_pos || '';

            const sigs = record.signatures; 
            if(sigs) { 
              const ldImg = (imgId, b64) => { if(b64 && b64.length > 50) { const el = document.getElementById(imgId); el.src = b64; el.style.display = 'block'; el.parentElement.querySelector('span').style.display = 'none'; } }; 
              ldImg('img_pad1', sigs.sig1); ldImg('img_pad2', sigs.sig2); ldImg('img_pad3', sigs.sig3); ldImg('img_pad4', sigs.sig4); 
            }

            let html = ''; let currentCat = '';
            if (record.observations && record.observations.length > 0) {
              record.observations.forEach(obs => { 
                  if(obs.category !== currentCat) { if(currentCat !== '') html += `</div>`; html += `<div class="p-3 mb-4 rounded shadow-sm group-cat-box"><h5 class="fw-bold text-success mb-3 pb-2" style="border-bottom: 2px solid var(--success);">${obs.category}</h5>`; currentCat = obs.category; }
                  html += createObsHtml({ cat: obs.category, sub: obs.subCategory, desc: obs.recommendation, cur: obs.currentState, app: obs.appropriateness, aft: obs.conditionAfter, rem: obs.remark }, obs.category === "5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ"); 
              });
              if(currentCat !== '') html += `</div>`;
            } else { 
              stdItems.forEach(item => { if(item.cat !== currentCat) { if(currentCat !== '') html += `</div>`; html += `<div class="p-3 mb-4 rounded shadow-sm group-cat-box"><h5 class="fw-bold text-success mb-3 pb-2" style="border-bottom: 2px solid var(--success);">${item.cat}</h5>`; currentCat = item.cat;} html += createObsHtml(item); }); 
              if(currentCat !== '') html += `</div>`;
            }
            document.getElementById('observationContainer').innerHTML = html;
        } else {
            Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
        }
      } catch (err) {
          hideLoader(); Swal.fire('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
      }
    }

    // 4. ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.deleteRecord = (id) => {
      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID: #${id} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`, icon: 'warning',
        showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#6c757d', confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then(async (result) => {
        if (result.isConfirmed) {
            showLoader(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID: #${id}...`);
            try {
                await deleteDoc(doc(db, "observations", String(id)));
                hideLoader(); showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); window.loadTableData(true); 
            } catch (err) {
                hideLoader(); Swal.fire("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", err.message, 'error'); 
            }
        }
      });
    }

    // 5. ‡∏•‡πá‡∏≠‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.toggleLock = async (id, currentLockStatus) => {
      const newStatus = !currentLockStatus;
      const actionText = newStatus ? '‡∏•‡πá‡∏≠‡∏Ñ' : '‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ';
      showLoader(`‡∏Å‡∏≥‡∏•‡∏±‡∏á${actionText}‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...`);
      try {
          await updateDoc(doc(db, "observations", String(id)), { isLocked: newStatus });
          hideLoader(); 
          Swal.fire({ icon: 'success', title: `${actionText}‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, timer: 2000, showConfirmButton: false });
          window.loadTableData(true); 
      } catch(err) {
          hideLoader(); Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
      }
    }

    // ==========================================
    // UI Helpers (Table, Forms, UI Logic)
    // ==========================================
    function populateTableFilters() {
      const pSet = new Set(), dSet = new Set(), gSet = new Set();
      globalTableData.forEach(r => { if(r.province) pSet.add(r.province); if(r.district) dSet.add(r.district); if(r.localGov) gSet.add(r.localGov); });
      const fill = (id, set, def) => { const sel = document.getElementById(id); const cur = sel.value; sel.innerHTML = `<option value="">üìç ${def}</option>`; Array.from(set).sort().forEach(v => sel.innerHTML += `<option value="${v}">${v}</option>`); sel.value = cur; };
      fill('filterProv', pSet, '‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'); fill('filterDist', dSet, '‡∏ó‡∏∏‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠'); fill('filterGov', gSet, '‡∏ó‡∏∏‡∏Å ‡∏≠‡∏õ‡∏ó.');
    }

    window.filterTable = () => {
      const fProv = document.getElementById('filterProv').value; const fDist = document.getElementById('filterDist').value; const fGov = document.getElementById('filterGov').value;
      filteredTableData = globalTableData.filter(row => (fProv === "" || row.province === fProv) && (fDist === "" || row.district === fDist) && (fGov === "" || row.localGov === fGov));
      renderTable(filteredTableData);
    }

    window.sortTable = (col) => {
      if(currentSortCol === col) { currentSortAsc = !currentSortAsc; } else { currentSortCol = col; currentSortAsc = true; }
      filteredTableData.sort((a, b) => {
        let valA = a[col], valB = b[col];
        if(col === 'recordId') { valA = Number(valA); valB = Number(valB); }
        else { if(typeof valA === 'string') valA = valA.toLowerCase(); if(typeof valB === 'string') valB = valB.toLowerCase(); }
        if (valA < valB) return currentSortAsc ? -1 : 1;
        if (valA > valB) return currentSortAsc ? 1 : -1;
        return 0;
      });
      ['recordId','timestamp','obsDate','localGov','district','province','elderlyName'].forEach(c => {if(document.getElementById('sort_'+c)) document.getElementById('sort_'+c).innerText = ''});
      if(document.getElementById('sort_'+col)) document.getElementById('sort_'+col).innerText = currentSortAsc ? ' ‚ñ≤' : ' ‚ñº';
      renderTable(filteredTableData);
    }

    function renderTable(data) {
      const tbody = document.getElementById('dataTableBody'); tbody.innerHTML = '';
      if(data.length === 0) { tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>'; return; }
      data.forEach(row => {
        const isLocked = row.isLocked;
        const lockBtn = isLocked ? `<button class="btn action-btn btn-secondary text-white shadow-sm" onclick="window.toggleLock('${row.recordId}', true)" title="‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ">üîí</button>` : `<button class="btn action-btn btn-success text-white shadow-sm" onclick="window.toggleLock('${row.recordId}', false)" title="‡∏•‡πá‡∏≠‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">üîì</button>`;
        const actBtn = isLocked 
            ? `<button class="btn action-btn btn-secondary text-white action-btn-edit" disabled title="‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà">‚úèÔ∏è</button><button class="btn action-btn btn-secondary text-white action-btn-del" disabled title="‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà">üóëÔ∏è</button>` 
            : `<button class="btn action-btn btn-warning text-white shadow-sm action-btn-edit" onclick="window.editRecord('${row.recordId}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</button><button class="btn action-btn btn-danger text-white shadow-sm action-btn-del" onclick="window.deleteRecord('${row.recordId}')" title="‡∏•‡∏ö">üóëÔ∏è</button>`;
        
        tbody.innerHTML += `
          <tr class="${isLocked ? 'row-locked' : ''}">
            <td class="fw-bold text-primary">#${row.recordId}</td><td>${row.updatedAt ? new Date(row.updatedAt).toLocaleDateString('th-TH') : '-'}</td><td>${row.obsDate || '-'}</td>
            <td>${row.localGov || '-'}</td><td>${row.district || '-'}</td><td>${row.province || '-'}</td><td>${row.elderlyName || '-'}</td>
            <td class="text-center"><div class="d-flex justify-content-center gap-1">${lockBtn}${actBtn}</div></td>
          </tr>`;
      });
    }

    window.addRepairRow = (r = {i:'', d:'', p:'-'}) => {
        if(repairRowCount >= 6) return showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 6 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö', 'warning');
        repairRowCount++;
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="text" class="form-control" value="${r.i}" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${repairRowCount}"></td>
            <td><input type="text" class="form-control" value="${r.d}" placeholder="‡∏™‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏°..."></td>
            <td><select class="form-select"><option value="-" ${r.p=='-'?'selected':''}>-</option><option value="‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏" ${r.p=='‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏'?'selected':''}>‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</option><option value="‡∏ä‡πà‡∏≤‡∏á" ${r.p=='‡∏ä‡πà‡∏≤‡∏á'?'selected':''}>‡∏ä‡πà‡∏≤‡∏á</option><option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" ${r.p=='‡∏≠‡∏∑‡πà‡∏ô‡πÜ'?'selected':''}>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select></td>
            <td class="text-center align-middle"><button class="btn btn-sm btn-outline-danger" onclick="this.closest('tr').remove(); repairRowCount--;"><span aria-hidden="true">&times;</span></button></td>
        `;
        document.getElementById('repairTbody').appendChild(tr);
    }

    const stdItems = [
      { cat: "1. ‡∏õ‡∏£‡∏∞‡∏ï‡∏π", sub: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á", desc: "‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å" }, { cat: "1. ‡∏õ‡∏£‡∏∞‡∏ï‡∏π", sub: "‡∏ò‡∏£‡∏ì‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π", desc: "‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏î‡∏∏‡∏î" },
      { cat: "2. ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", sub: "‡∏û‡∏∑‡πâ‡∏ô", desc: "‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏°‡πà‡∏•‡∏∑‡πà‡∏ô" }, { cat: "2. ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", sub: "‡∏õ‡∏£‡∏∞‡∏ï‡∏π", desc: "‡∏Å‡∏ß‡πâ‡∏≤‡∏á 86 - 90 ‡∏ã‡∏°. ‡∏•‡∏π‡∏Å‡∏ö‡∏¥‡∏î‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 85 ‡∏ã‡∏°." },
      { cat: "2. ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", sub: "‡∏£‡∏≤‡∏ß‡∏à‡∏±‡∏ö", desc: "‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏ô‡∏±‡∏á ‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô 85 ‡∏ã‡∏°." }, { cat: "2. ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", sub: "‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå", desc: "‡∏ä‡∏±‡∏Å‡πÇ‡∏Ñ‡∏£‡∏Å‡∏ô‡∏±‡πà‡∏á‡∏´‡πâ‡∏≠‡∏¢‡∏Ç‡∏≤ ‡∏™‡∏π‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 16-19 ‡∏ô‡∏¥‡πâ‡∏ß" },
      { cat: "3. ‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô", sub: "‡∏ú‡∏¥‡∏ß‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™", desc: "‡∏ú‡∏¥‡∏ß‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡πÑ‡∏°‡πà‡∏•‡∏∑‡πà‡∏ô ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏á‡πà‡∏≤‡∏¢" }, { cat: "3. ‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô", sub: "‡∏£‡∏∞‡∏î‡∏±‡∏ö", desc: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö" },
      { cat: "3. ‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô", sub: "‡∏ß‡∏±‡∏™‡∏î‡∏∏", desc: "‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ù‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏ó‡πâ‡∏≤" }, { cat: "4. ‡∏ö‡∏±‡∏ô‡πÑ‡∏î", sub: "‡∏£‡∏≤‡∏ß‡∏à‡∏±‡∏ö", desc: "‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô ‡∏™‡∏π‡∏á 80 - 90 ‡∏ã‡∏°." },
      { cat: "4. ‡∏ö‡∏±‡∏ô‡πÑ‡∏î", sub: "‡∏Ç‡∏ô‡∏≤‡∏î", desc: "‡∏•‡∏π‡∏Å‡∏ô‡∏≠‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 25 ‡∏ã‡∏°. ‡∏•‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 18 ‡∏ã‡∏°." }, { cat: "4. ‡∏ö‡∏±‡∏ô‡πÑ‡∏î", sub: "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á", desc: "‡∏°‡∏µ‡∏ä‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°" }
    ];

    let itemCounter = 0;
    function createObsHtml(item, isOther=false) {
      itemCounter++; const id = itemCounter;
      const title = isOther ? `<div class="d-flex mb-3"><input type="text" class="form-control w-50 custom-cat text-primary fw-bold" value="${item.sub}" placeholder="‡∏£‡∏∞‡∏ö‡∏∏..."><button class="btn btn-outline-danger ms-auto btn-sm rounded-pill" onclick="this.closest('.observation-item').remove()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ</button></div>`
                            : `<div class="obs-title">${item.sub} <span class="text-muted fw-normal" style="font-size:0.95rem;">(${item.desc})</span></div>`;
      const checkC = val => item.cur === val ? 'checked' : ''; const checkA = val => item.app === val ? 'checked' : ''; const checkF = val => item.aft === val ? 'checked' : '';
      return `<div class="observation-item shadow-sm" data-category="${item.cat}" data-sub="${item.sub}" data-rec="${item.desc}">
          ${title}
          <div class="row g-3">
            <div class="col-md-3"><div class="radio-group-box"><div class="group-title">‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô <span class="text-danger">*</span></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio current-state" name="c_${id}" id="c_${id}_1" value="‡∏°‡∏µ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á" ${checkC("‡∏°‡∏µ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á")}><label for="c_${id}_1" class="radio-label">‡∏°‡∏µ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</label></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio current-state" name="c_${id}" id="c_${id}_2" value="‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á" ${checkC("‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á")}><label for="c_${id}_2" class="radio-label">‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</label></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio current-state" name="c_${id}" id="c_${id}_3" value="‡πÑ‡∏°‡πà‡∏°‡∏µ" ${checkC("‡πÑ‡∏°‡πà‡∏°‡∏µ")}><label for="c_${id}_3" class="radio-label">‡πÑ‡∏°‡πà‡∏°‡∏µ</label></div></div></div>
            <div class="col-md-3"><div class="radio-group-box"><div class="group-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° <span class="text-danger">*</span></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio appropriateness" name="a_${id}" id="a_${id}_1" value="‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°" ${checkA("‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°")}><label for="a_${id}_1" class="radio-label text-success fw-bold">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</label></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio appropriateness" name="a_${id}" id="a_${id}_2" value="‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°" ${checkA("‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°")}><label for="a_${id}_2" class="radio-label text-danger fw-bold">‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</label></div></div></div>
            <div class="col-md-3"><div class="radio-group-box"><div class="group-title">‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á <span class="text-danger">*</span></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio condition-after" name="f_${id}" id="f_${id}_1" value="‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ" ${checkF("‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ")}><label for="f_${id}_1" class="radio-label">‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</label></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio condition-after" name="f_${id}" id="f_${id}_2" value="‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ" ${checkF("‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ")}><label for="f_${id}_2" class="radio-label">‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</label></div><div class="form-check"><input type="radio" class="form-check-input tablet-radio condition-after" name="f_${id}" id="f_${id}_3" value="‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ" ${checkF("‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ")}><label for="f_${id}_3" class="radio-label text-danger">‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</label></div></div></div>
            <div class="col-md-3"><div class="radio-group-box"><div class="group-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</div><textarea class="form-control remark-input border-0 bg-transparent p-0" rows="4" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î...">${item.rem || ''}</textarea></div></div>
          </div>
        </div>`;
    }

    window.addOtherItem = () => { document.getElementById('observationContainer').insertAdjacentHTML('beforeend', createObsHtml({cat:"5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ", sub:"", desc:"", cur:"", app:"", aft:"", rem:""}, true)); }

    // Modal Signature Logic
    let modalCtx = null; let modalCanvas = null; let isDrawing = false;
    function initModalCanvas() {
      modalCanvas = document.getElementById('modalCanvas');
      const rect = modalCanvas.parentElement.getBoundingClientRect();
      modalCanvas.width = rect.width; modalCanvas.height = 300;
      modalCtx = modalCanvas.getContext('2d');
      modalCtx.fillStyle = "#ffffff"; modalCtx.fillRect(0, 0, modalCanvas.width, modalCanvas.height);
      const getPos = (e) => { const r = modalCanvas.getBoundingClientRect(); return { x: ((e.touches ? e.touches[0].clientX : e.clientX) - r.left) * (modalCanvas.width / r.width), y: ((e.touches ? e.touches[0].clientY : e.clientY) - r.top) * (modalCanvas.height / r.height) }; };
      const startDraw = (e) => { e.preventDefault(); isDrawing = true; modalCtx.beginPath(); const pos = getPos(e); modalCtx.moveTo(pos.x, pos.y); };
      const endDraw = () => { isDrawing = false; };
      const draw = (e) => { if(!isDrawing) return; e.preventDefault(); const pos = getPos(e); modalCtx.lineWidth = 3; modalCtx.lineCap = 'round'; modalCtx.strokeStyle = '#000080'; modalCtx.lineTo(pos.x, pos.y); modalCtx.stroke(); };
      modalCanvas.onmousedown = startDraw; modalCanvas.onmouseup = endDraw; modalCanvas.onmousemove = draw;
      modalCanvas.ontouchstart = startDraw; modalCanvas.ontouchend = endDraw; modalCanvas.ontouchmove = draw;
    }

    window.openSigModal = (targetId, titleStr) => {
      currentSigTarget = targetId; document.getElementById('sigModalTitle').innerText = `‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô: ${titleStr}`;
      const myModal = new bootstrap.Modal(document.getElementById('sigModal')); myModal.show();
      setTimeout(initModalCanvas, 250); 
    }
    window.clearModalSignature = () => { if(modalCtx && modalCanvas) { modalCtx.fillStyle="#ffffff"; modalCtx.fillRect(0,0,modalCanvas.width,modalCanvas.height); } }
    window.confirmSignature = () => {
      if(!modalCanvas) return;
      const dataUrl = modalCanvas.toDataURL('image/png');
      const imgTarget = document.getElementById('img_' + currentSigTarget);
      imgTarget.src = dataUrl; imgTarget.style.display = 'block';
      imgTarget.parentElement.querySelector('span').style.display = 'none';
      bootstrap.Modal.getInstance(document.getElementById('sigModal')).hide();
    }

    window.resetForm = () => {
      isEditMode = false; document.getElementById('formTitle').innerText = "‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà";
      document.getElementById('manualRecordId').readOnly = false; document.getElementById('manualRecordId').value = "";
      document.querySelectorAll('input[type="text"]:not(#manualRecordId):not(#filterProv):not(#filterDist):not(#filterGov):not(#s2_pos):not(#s4_pos), input[type="number"], input[type="date"], input[type="time"], textarea').forEach(el => el.value = "");
      document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(el => el.checked = false);
      
      document.getElementById('s2_pos').value = ""; document.getElementById('s4_pos').value = "";
      document.getElementById('repairTbody').innerHTML = ''; repairRowCount = 0;
      for(let i=0; i<6; i++) window.addRepairRow();

      let html = ''; let currentCat = '';
      stdItems.forEach(item => {
         if (item.cat !== currentCat) { 
             if(currentCat !== '') html += `</div>`;
             html += `<div class="p-3 mb-4 rounded shadow-sm group-cat-box"><h5 class="fw-bold text-success mb-3 pb-2" style="border-bottom: 2px solid var(--success);">${item.cat}</h5>`; 
             currentCat = item.cat; 
         }
         html += createObsHtml(item);
      });
      if(currentCat !== '') html += `</div>`;
      document.getElementById('observationContainer').innerHTML = html;
      document.querySelectorAll('.sig-preview img').forEach(img => { img.src = ''; img.style.display = 'none'; img.parentElement.querySelector('span').style.display = 'inline';});
      window.showPage('page3');
    }

    // ==========================================
    // Data Extraction & Printing
    // ==========================================
    function extractOtherText(str) {
       if(!str || !str.includes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')) return '';
       const match = str.match(/\(([^)]+)\)/);
       if(match) return match[1];
       return str.split('‡∏≠‡∏∑‡πà‡∏ô‡πÜ').pop().replace(/^[,\s]+/, '').trim();
    }

    function validateObservation() {
       let missing = [];
       document.querySelectorAll('.observation-item').forEach(item => {
          let id = item.querySelector('.current-state').name.split('_')[1];
          let cat = item.dataset.category; let sub = item.dataset.sub;
          if(!document.querySelector(`input[name="c_${id}"]:checked`) || !document.querySelector(`input[name="a_${id}"]:checked`) || !document.querySelector(`input[name="f_${id}"]:checked`)) {
             missing.push(`- ${cat}: ${sub}`);
          }
       });
       return missing;
    }

    function getFormData() {
      let reqArr = []; document.querySelectorAll('.chk-req:checked').forEach(c => { if(c.value!=='‡∏≠‡∏∑‡πà‡∏ô‡πÜ') reqArr.push(c.value); }); 
      if(document.querySelector('.chk-req[value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]').checked) { 
         let otherText = document.getElementById('reqOtherText').value.trim();
         if(otherText) reqArr.push(`‡∏≠‡∏∑‡πà‡∏ô‡πÜ (${otherText})`); else reqArr.push('‡∏≠‡∏∑‡πà‡∏ô‡πÜ'); 
      } 
      let requestItemsText = reqArr.join(', ');

      const g = {
        recordId: document.getElementById('manualRecordId').value.trim(), localGov: document.getElementById('localGov').value, govDistrict: document.getElementById('govDistrict').value, govProvince: document.getElementById('govProvince').value, inspector1: document.getElementById('inspector1').value, inspector2: document.getElementById('inspector2').value, 
        obsDate: formatDateBE(document.getElementById('obsDate').value), timeStart: document.getElementById('timeStart').value, timeEnd: document.getElementById('timeEnd').value,
        supportAgency: document.getElementById('supportAgency').value, budgetYear: document.getElementById('budgetYear').value, budgetAmount: document.getElementById('budgetAmount').value, historyCount: document.getElementById('historyCount').value, historyNum: document.getElementById('historyNum').value,
        elderlyName: document.getElementById('elderlyName').value, age: document.getElementById('age').value, gender: document.getElementById('gender').value, houseNo: document.getElementById('houseNo').value, moo: document.getElementById('moo').value, subDistrict: document.getElementById('subDistrict').value, district: document.getElementById('district').value, province: document.getElementById('province').value,
        livingStatus: document.getElementById('livingStatus').value, caregiver: document.getElementById('caregiver').value, houseType: document.getElementById('houseType').value, famTotal: document.getElementById('famTotal').value, famChild: document.getElementById('famChild').value, famElder: document.getElementById('famElder').value, famWorker: document.getElementById('famWorker').value,
        elderlyIncome: document.getElementById('elderlyIncome').value, incomeSource: document.getElementById('incomeSource').value, totalFamilyIncome: document.getElementById('totalFamilyIncome').value, landOwnership: document.getElementById('landOwnership').value,
        requestItems: requestItemsText, receivedItems: document.getElementById('receivedItems').value, 
        finishDate: formatDateBE(document.getElementById('finishDate').value), durYear: document.getElementById('durYear').value, durMonth: document.getElementById('durMonth').value, otherAgency: document.getElementById('otherAgency').value, inspectorSummary: document.getElementById('inspectorSummary').value, 
        s2_pos: document.getElementById('s2_pos').value, s4_pos: document.getElementById('s4_pos').value,
        repairs: []
      };

      const rTrs = document.getElementById('repairTbody').querySelectorAll('tr');
      rTrs.forEach(tr => {
         const iInput = tr.querySelector('td:nth-child(1) input'); const dInput = tr.querySelector('td:nth-child(2) input'); const pSelect = tr.querySelector('td:nth-child(3) select');
         if(iInput && dInput && pSelect) { const i = iInput.value; const d = dInput.value; const p = pSelect.value; if(i || d) g.repairs.push({i,d,p}); }
      });
      
      const obsData = []; document.querySelectorAll('.observation-item').forEach(item => { const cust = item.querySelector('.custom-cat'); obsData.push({ category: cust ? "5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ" : item.dataset.category, subCategory: cust ? cust.value : item.dataset.sub, recommendation: cust ? cust.value : item.dataset.rec, currentState: item.querySelector('.current-state:checked')?.value || '-', appropriateness: item.querySelector('.appropriateness:checked')?.value || '-', conditionAfter: item.querySelector('.condition-after:checked')?.value || '-', remark: item.querySelector('.remark-input').value }); });
      const sNames = { n1: document.getElementById('s1_name').value, n2: document.getElementById('s2_name').value, n3: document.getElementById('s3_name').value, n4: document.getElementById('s4_name').value };
      const getSigImgData = (id) => { const img = document.getElementById('img_'+id); return img && img.src.length > 50 ? img.src : ""; };
      const sigs = { sig1: getSigImgData('pad1'), sig2: getSigImgData('pad2'), sig3: getSigImgData('pad3'), sig4: getSigImgData('pad4') };
      
      return { general: g, observations: obsData, signames: sNames, signatures: sigs };
    }

    window.previewPrint = () => {
      const missing = validateObservation();
      if(missing.length > 0) { Swal.fire({ title: '‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå!<br><br>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥:<br>' + missing.join("<br>"), icon: 'warning' }); return; }
      const data = getFormData();
      populatePrintPage(data.general, data.signames, data.observations, data.signatures);
      window.showPage('page4');
    }

    function populatePrintPage(g, sNames, obsData, sigs) {
      const setTxt = (id, text) => { const el = document.getElementById(id); if (el) el.innerText = text || ''; };
      const setCb = (id, isChecked) => { const el = document.getElementById(id); if (el) el.innerText = isChecked ? '‚òë' : '‚òê'; };

      setTxt('p_localGov', g.localGov); setTxt('p_gDist', g.govDistrict); setTxt('p_gProv', g.govProvince); setTxt('p_insp1', g.inspector1); setTxt('p_insp2', g.inspector2);
      if(g.obsDate){ const d = new Date(parseDateToISO(g.obsDate)); const m=["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô","‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"]; setTxt('p_d', d.getDate()); setTxt('p_m', m[d.getMonth()]); setTxt('p_y', d.getFullYear()+543); } else { setTxt('p_d', ''); setTxt('p_m', ''); setTxt('p_y', ''); }
      setTxt('p_t1', g.timeStart); setTxt('p_t2', g.timeEnd);
      setCb('cb_a1', g.supportAgency=='‡∏û‡∏°‡∏à.'); setCb('cb_a2', g.supportAgency=='‡∏®‡∏û‡∏™.'); setCb('cb_a3', g.supportAgency=='‡∏≠‡∏∑‡πà‡∏ô‡πÜ'); setTxt('p_agencyText', g.supportAgency=='‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ? g.otherAgency : '');
      setTxt('p_year', g.budgetYear); setTxt('p_budget', g.budgetAmount); setCb('cb_h1', g.historyCount=='0'); setCb('cb_h2', g.historyCount=='1'); setTxt('p_hist', g.historyNum);
      setTxt('p_name', g.elderlyName); setTxt('p_age', g.age); setCb('cb_m', g.gender=='‡∏ä‡∏≤‡∏¢'); setCb('cb_f', g.gender=='‡∏´‡∏ç‡∏¥‡∏á');
      setTxt('p_house', g.houseNo); setTxt('p_moo', g.moo); setTxt('p_sub', g.subDistrict); setTxt('p_dist', g.district); setTxt('p_prov', g.province);
      setCb('cb_l1', g.livingStatus=='‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'); setCb('cb_l2', g.livingStatus=='‡∏Ñ‡∏π‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï'); setCb('cb_l3', g.livingStatus=='‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß'); setCb('cb_c1', g.caregiver=='‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•'); setCb('cb_c2', g.caregiver=='‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•');
      setCb('cb_ht1', g.houseType=='‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'); setCb('cb_ht2', g.houseType=='‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô'); setCb('cb_ht3', g.houseType=='‡∏ó‡∏≤‡∏ß‡∏ô‡πå‡πÄ‡∏Æ‡∏≤‡∏™‡πå'); setCb('cb_ht4', g.houseType=='‡∏ï‡∏∂‡∏Å‡πÅ‡∏ñ‡∏ß');
      setTxt('p_f1', g.famTotal || g.famData?.t); setTxt('p_f2', g.famChild || g.famData?.c); setTxt('p_f3', g.famElder || g.famData?.e); setTxt('p_f4', g.famWorker || g.famData?.w);
      setTxt('p_inc1', g.elderlyIncome); setTxt('p_inc2', g.totalFamilyIncome);
      let incS = g.incomeSource || ""; setCb('cb_i1', incS.includes('‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏')); setCb('cb_i2', incS.includes('‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏Å‡∏≤‡∏£')); setCb('cb_i3', incS.includes('‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£')); setCb('cb_i4', incS.includes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')); setTxt('p_incSrc', incS);
      setCb('cb_land1', g.landOwnership=='‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏á'); setCb('cb_land2', g.landOwnership=='‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô/‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥'); setCb('cb_land3', g.landOwnership=='‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞');
      let reqS = g.requestItems || ""; setCb('cb_rq1', reqS.includes('‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô')); setCb('cb_rq2', reqS.includes('‡∏ù‡∏≤‡∏ö‡πâ‡∏≤‡∏ô') || reqS.includes('‡∏õ‡∏£‡∏∞‡∏ï‡∏π') || reqS.includes('‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á') || reqS.includes('‡πÑ‡∏ü‡∏ü‡πâ‡∏≤')); setCb('cb_rq3', reqS.includes('‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥')); setCb('cb_rq4', reqS.includes('‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á')); 
      let reqOtherChecked = !reqS.includes('‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô') && !reqS.includes('‡∏ù‡∏≤‡∏ö‡πâ‡∏≤‡∏ô') && !reqS.includes('‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥') && !reqS.includes('‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á') && reqS !== "";
      setCb('cb_rq5', reqOtherChecked || reqS.includes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')); setTxt('p_reqOther', reqOtherChecked ? reqS : extractOtherText(reqS));
      const recArr = (g.receivedItems || "").match(/.{1,80}/g) || []; setTxt('p_recItems1', recArr[0]); setTxt('p_recItems2', recArr[1]);
      if(g.finishDate && g.finishDate !== '-') { const fd = new Date(parseDateToISO(g.finishDate)); setTxt('p_fD', fd.getDate()); setTxt('p_fM', fd.getMonth()+1); setTxt('p_fY', fd.getFullYear()+543); } else { setTxt('p_fD', ''); setTxt('p_fM', ''); setTxt('p_fY', ''); }
      setTxt('p_dy', g.durYear || g.durData?.y); setTxt('p_dm', g.durMonth || g.durData?.m);
      setCb('cb_oa1', g.otherAgency == '‡πÑ‡∏°‡πà‡∏°‡∏µ' || !g.otherAgency); setCb('cb_oa2', g.otherAgency && g.otherAgency != '‡πÑ‡∏°‡πà‡∏°‡∏µ'); setTxt('p_otherAgency', (g.otherAgency && g.otherAgency != '‡πÑ‡∏°‡πà‡∏°‡∏µ') ? g.otherAgency : '');

      let pTableHTML = '';
      for(let i=0; i<6; i++) {
        const rep = (g.repairs && g.repairs[i]) ? g.repairs[i] : {i:'', d:'', p:''};
        const c1 = rep.p === '‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏' ? '‚òë' : '‚òê'; const c2 = rep.p === '‡∏ä‡πà‡∏≤‡∏á' ? '‚òë' : '‚òê'; const c3 = (rep.p !== '‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏' && rep.p !== '‡∏ä‡πà‡∏≤‡∏á' && rep.p !== '-' && rep.p !== '') ? '‚òë' : '‚òê';
        pTableHTML += `<tr><td>${rep.i ? (i+1)+'. '+rep.i : (i+1)+'. '}</td><td style="color:blue;">${rep.d || ''}</td><td><span class="p-check">${c1}</span> ‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ <span class="p-check ms-2">${c2}</span> ‡∏ä‡πà‡∏≤‡∏á <span class="p-check ms-2">${c3}</span> ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</td></tr>`;
      }
      const pRepTable = document.getElementById('p_repairTable'); if(pRepTable) pRepTable.innerHTML = pTableHTML;

      let obsHtml1 = '', obsHtml2 = '', obsHtml3 = '';
      if(obsData) {
        obsData.forEach((obs, index) => {
          const isCheck = (val, target) => val === target ? '‚òë' : '‚òê';
          let titleHtml = `<b>${obs.category}</b><br>${obs.subCategory}: ${obs.recommendation}`;
          if(obs.category === "1. ‡∏õ‡∏£‡∏∞‡∏ï‡∏π" && obs.subCategory === "‡∏ò‡∏£‡∏ì‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π") titleHtml = `<b>1. ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</b><br>‡∏ò‡∏£‡∏ì‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π: ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏î‡∏∏‡∏î<br>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ò‡∏£‡∏ì‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô 8 ‡∏ã‡∏°.`;
          let row = `<tr><td>${titleHtml}<br><div class="mt-1"><span class="p-check">${isCheck(obs.currentState, '‡∏°‡∏µ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á')}</span> ‡∏°‡∏µ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div><div><span class="p-check">${isCheck(obs.currentState, '‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á')}</span> ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß/‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div><div><span class="p-check">${isCheck(obs.currentState, '‡πÑ‡∏°‡πà‡∏°‡∏µ')}</span> ‡πÑ‡∏°‡πà‡∏°‡∏µ</div></td><td><div><span class="p-check">${isCheck(obs.appropriateness, '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°')}</span> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</div><div><span class="p-check">${isCheck(obs.appropriateness, '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°')}</span> ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</div></td><td><div><span class="p-check">${isCheck(obs.conditionAfter, '‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ')}</span> ‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div><div><span class="p-check">${isCheck(obs.conditionAfter, '‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ')}</span> ‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div><div><span class="p-check">${isCheck(obs.conditionAfter, '‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ')}</span> ‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div></td><td style="color:blue;">${obs.remark !== '-' ? obs.remark : ''}</td></tr>`;
          if(index < 3) obsHtml1 += row; else if(index >= 3 && index < 12) obsHtml2 += row; else obsHtml3 += row;
        });
      }
      const op1 = document.getElementById('p_obsTable_p1'); if(op1) op1.innerHTML = obsHtml1; const op2 = document.getElementById('p_obsTable_p2'); if(op2) op2.innerHTML = obsHtml2; const op3 = document.getElementById('p_obsTable_p3'); if(op3) op3.innerHTML = obsHtml3;

      const cmts = (g.inspectorSummary || "").match(/.{1,80}/g) || [];
      setTxt('p_comment1', cmts[0]); setTxt('p_comment2', cmts[1]); setTxt('p_comment3', cmts[2]);
      
      setTxt('o_n1', sNames ? sNames.n1 : ''); setTxt('o_p1', document.getElementById('s1_pos') ? document.getElementById('s1_pos').value : ''); setTxt('o_a1', document.getElementById('s1_agency') ? document.getElementById('s1_agency').value : '');
      setTxt('o_n2', sNames ? sNames.n2 : ''); setTxt('o_p2', g.s2_pos || '');
      setTxt('o_n3', sNames ? sNames.n3 : ''); setTxt('o_p3', document.getElementById('s3_pos') ? document.getElementById('s3_pos').value : ''); setTxt('o_a3', document.getElementById('s3_agency') ? document.getElementById('s3_agency').value : '');
      setTxt('o_n4', sNames ? sNames.n4 : ''); setTxt('o_p4', g.s4_pos || '');

      const setSigImg = (imgId, base64) => { const img = document.getElementById(imgId); if(base64 && base64.length > 50) { img.src = base64; img.style.display = 'block'; } else { img.style.display = 'none'; } };
      setSigImg('img_pad1_out', sigs.sig1); setSigImg('img_pad2_out', sigs.sig2); setSigImg('img_pad3_out', sigs.sig3); setSigImg('img_pad4_out', sigs.sig4);
    }

    // ==========================================
    // Dashboard Logic
    // ==========================================
    window.loadDashboardData = async () => {
      showLoader('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
      document.getElementById('dashResult').style.display = 'none'; document.getElementById('dashEmpty').style.display = 'none';
      try {
        const querySnapshot = await getDocs(collection(db, "observations"));
        let data = [];
        querySnapshot.forEach((doc) => { 
            let d = doc.data();
            data.push({ id: d.general.recordId, elderlyName: d.general.elderlyName, localGov: d.general.localGov, district: d.general.district, province: d.general.province, budget: Number(d.general.budgetAmount)||0, age: Number(d.general.age)||0, inspectorSummary: d.general.inspectorSummary, observations: d.observations });
        });
        hideLoader(); globalDashData = data; populateDashFiltersInit(); document.getElementById('dashEmpty').style.display = 'block';
      } catch (err) {
        hideLoader(); Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î", err.message, 'error');
      }
    }

    function populateDashFiltersInit() {
      const pSet = new Set(); globalDashData.forEach(r => { if(r.province) pSet.add(r.province); });
      const pSel = document.getElementById('dProv'); pSel.innerHTML = '<option value="">-- ‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>';
      Array.from(pSet).sort().forEach(v => pSel.innerHTML += `<option value="${v}">${v}</option>`);
      document.getElementById('dDist').innerHTML = '<option value="">-- ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option>'; document.getElementById('dGov').innerHTML = '<option value="">-- ‡∏ó‡∏∏‡∏Å ‡∏≠‡∏õ‡∏ó. --</option>'; document.getElementById('dName').innerHTML = '<option value="">-- ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>';
      dashActiveFilter = null; window.updateDashFilters('init');
    }

    window.updateDashFilters = (level) => {
      const fP = document.getElementById('dProv').value, fD = document.getElementById('dDist').value, fG = document.getElementById('dGov').value;
      const dSet = new Set(), gSet = new Set(), nSet = new Set();
      globalDashData.forEach(r => {
        if(level === 'prov' || level === 'init') { if(r.province === fP || fP === "") dSet.add(r.district); }
        if(level === 'dist' || level === 'prov' || level === 'init') { if((r.province === fP || fP === "") && (r.district === fD || fD === "")) gSet.add(r.localGov); }
        if(level === 'gov' || level === 'dist' || level === 'prov' || level === 'init') { if((r.province === fP || fP === "") && (r.district === fD || fD === "") && (r.localGov === fG || fG === "")) nSet.add({id: r.id, name: r.elderlyName}); }
      });

      if(level === 'prov' || level === 'init') { const dSel = document.getElementById('dDist'); dSel.innerHTML = '<option value="">-- ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option>'; Array.from(dSet).sort().forEach(v => dSel.innerHTML += `<option value="${v}">${v}</option>`); document.getElementById('dGov').innerHTML = '<option value="">-- ‡∏ó‡∏∏‡∏Å ‡∏≠‡∏õ‡∏ó. --</option>'; document.getElementById('dName').innerHTML = '<option value="">-- ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>'; }
      if(level === 'dist' || level === 'prov' || level === 'init') { const gSel = document.getElementById('dGov'); gSel.innerHTML = '<option value="">-- ‡∏ó‡∏∏‡∏Å ‡∏≠‡∏õ‡∏ó. --</option>'; Array.from(gSet).sort().forEach(v => gSel.innerHTML += `<option value="${v}">${v}</option>`); document.getElementById('dName').innerHTML = '<option value="">-- ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>'; }
      if(level === 'gov' || level === 'dist' || level === 'prov' || level === 'init') { const nSel = document.getElementById('dName'); nSel.innerHTML = '<option value="">-- ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>'; Array.from(nSet).sort((a,b)=>a.name.localeCompare(b.name)).forEach(v => nSel.innerHTML += `<option value="${v.id}">${v.name} (ID:${v.id})</option>`); }
      window.renderDashResult();
    }

    window.clearChartFilter = () => { dashActiveFilter = null; document.getElementById('chartFilterIndicator').style.display = 'none'; window.renderDashResult(); }

    window.renderDashResult = () => {
      const fP = document.getElementById('dProv').value, fD = document.getElementById('dDist').value, fG = document.getElementById('dGov').value, selId = document.getElementById('dName').value;
      let filtered = globalDashData.filter(d => (fP === "" || d.province === fP) && (fD === "" || d.district === fD) && (fG === "" || d.localGov === fG) && (selId === "" || d.id == selId));
      
      const kpiTotalProj = filtered.length; const kpiTotalGovs = new Set(filtered.map(d => d.localGov)).size; const kpiTotalBudg = filtered.reduce((s, d) => s + d.budget, 0); const kpiAvgAge = kpiTotalProj > 0 ? (filtered.reduce((s,d)=>s+d.age,0)/kpiTotalProj).toFixed(1) : 0;
      let totalObsKpi=0, appObsKpi=0;
      filtered.forEach(d => { if(d.observations) d.observations.forEach(o => { if(o.appropriateness==='‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°' || o.appropriateness==='‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') totalObsKpi++; if(o.appropriateness==='‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') appObsKpi++; }); });
      const kpiAppRate = totalObsKpi > 0 ? ((appObsKpi/totalObsKpi)*100).toFixed(1) : 0;

      document.getElementById('txtKpi1').innerText = selId ? '‡∏£‡∏´‡∏±‡∏™‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á' : '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÅ‡∏´‡πà‡∏á)'; document.getElementById('resTotal').innerText = selId ? `#${filtered[0].id}` : kpiTotalProj; document.getElementById('resGovCount').innerText = selId ? '-' : kpiTotalGovs; document.getElementById('resBudget').innerText = kpiTotalBudg.toLocaleString(); document.getElementById('txtKpiAge').innerText = selId ? '‡∏≠‡∏≤‡∏¢‡∏∏‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)' : '‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏õ‡∏µ)'; document.getElementById('resAge').innerText = selId ? filtered[0].age : kpiAvgAge; document.getElementById('resAppRate').innerText = `${kpiAppRate}%`;

      if (dashActiveFilter) {
          if (dashActiveFilter.type === 'approp') filtered = filtered.filter(d => d.observations && d.observations.some(o => o.appropriateness === dashActiveFilter.value));
          else if (dashActiveFilter.type === 'category') filtered = filtered.filter(d => d.observations && d.observations.some(o => o.category === dashActiveFilter.value));
      }
      if(filtered.length === 0) { document.getElementById('dashResult').style.display = 'none'; document.getElementById('dashEmpty').style.display = 'block'; return; }

      let appCount = { '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°': 0, '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°': 0, '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏': 0 }; let condCount = { '‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ': 0, '‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ': 0, '‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ': 0 }; let catAppCount = {};
      filtered.forEach(d => {
          if (d.observations && d.observations.length > 0) {
              d.observations.forEach(obs => {
                  if (obs.appropriateness === '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') appCount['‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°']++; else if (obs.appropriateness === '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') appCount['‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°']++; else appCount['‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏']++;
                  if (condCount[obs.conditionAfter] !== undefined) condCount[obs.conditionAfter]++;
                  let cat = obs.category;
                  if(cat && cat !== "5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ") { if(!catAppCount[cat]) catAppCount[cat] = { '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°': 0, '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°': 0 }; if(obs.appropriateness === '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') catAppCount[cat]['‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°']++; if(obs.appropriateness === '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') catAppCount[cat]['‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°']++; }
              });
          }
      });

      if(dashCharts.approp) dashCharts.approp.destroy(); if(dashCharts.cond) dashCharts.cond.destroy(); if(dashCharts.catApprop) dashCharts.catApprop.destroy();
      dashCharts.approp = new Chart(document.getElementById('chApprop'), { type: 'doughnut', data: { labels: Object.keys(appCount), datasets: [{ data: Object.values(appCount), backgroundColor: ['#10b981', '#ef4444', '#cbd5e1'] }] }, options: { plugins: { legend: { position: 'bottom' } }, onClick: (e, active) => { if(active.length>0) { dashActiveFilter = {type: 'approp', value: Object.keys(appCount)[active[0].index]}; document.getElementById('chartFilterIndicator').style.display='block'; document.getElementById('chartFilterText').innerText = `‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° = ${dashActiveFilter.value}`; window.renderDashResult(); } } } });
      dashCharts.cond = new Chart(document.getElementById('chCond'), { type: 'pie', data: { labels: Object.keys(condCount), datasets: [{ data: Object.values(condCount), backgroundColor: ['#0ea5e9', '#f59e0b', '#ef4444'] }] }, options: { plugins: { legend: { position: 'bottom' } } } });
      const cats = Object.keys(catAppCount).sort(); const dApp = cats.map(c => catAppCount[c]['‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°']); const dNotApp = cats.map(c => catAppCount[c]['‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°']);
      dashCharts.catApprop = new Chart(document.getElementById('chCatApprop'), { type: 'bar', data: { labels: cats, datasets: [ { label: '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°', data: dApp, backgroundColor: '#10b981' }, { label: '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°', data: dNotApp, backgroundColor: '#ef4444' } ] }, options: { scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }, onClick: (e, active) => { if(active.length>0) { dashActiveFilter = {type: 'category', value: cats[active[0].index]}; document.getElementById('chartFilterIndicator').style.display='block'; document.getElementById('chartFilterText').innerText = `‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà = ${dashActiveFilter.value}`; window.renderDashResult(); } } } });

      const tHead = document.getElementById('resObsHead'); const tBody = document.getElementById('resObsTable'); let rHtml = '';
      if (selId) {
        document.getElementById('pivotControls').style.display = 'none';
        tHead.innerHTML = `<tr><th width="15%">‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà</th><th width="15%">‡∏´‡∏°‡∏ß‡∏î‡∏¢‡πà‡∏≠‡∏¢</th><th width="20%">‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th><th width="15%">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</th><th width="20%">‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</th></tr>`;
        let tHtml = '';
        if(filtered[0].observations) { filtered[0].observations.forEach(obs => { tHtml += `<tr><td>${obs.category}</td><td>${obs.subCategory}</td><td>${obs.currentState}</td><td><span class="badge bg-${obs.appropriateness === '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°' ? 'success' : (obs.appropriateness === '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°' ? 'danger' : 'secondary')}">${obs.appropriateness}</span></td><td>${obs.conditionAfter}</td></tr>`; if(obs.remark && obs.remark !== '-') rHtml += `<div class="mb-2 pb-2 border-bottom"><b>${obs.category} - ${obs.subCategory}:</b> ${obs.remark}</div>`; }); }
        tBody.innerHTML = tHtml; document.getElementById('remarksSection').style.display = 'block'; 
        document.getElementById('resRemarks').innerHTML = `<h6 class="text-danger fw-bold">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</h6><p style="white-space: pre-wrap;">${filtered[0].inspectorSummary || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'}</p><hr>${rHtml || '<div class="text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>'}`;
      } else {
        document.getElementById('pivotControls').style.display = 'inline-flex'; document.getElementById('remarksSection').style.display = 'none';
        const dim = document.getElementById('pivotDim').value;
        if(dim === 'category') {
            tHead.innerHTML = `<tr><th>‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏¢‡πà‡∏≠‡∏¢</th><th>‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</th><th>‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</th><th>‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</th></tr>`;
            let tHtml = ''; const aggC = {};
            filtered.forEach(d => { if(d.observations) d.observations.forEach(obs => { if(!aggC[obs.category]) aggC[obs.category] = {}; if(!aggC[obs.category][obs.subCategory]) aggC[obs.category][obs.subCategory] = { app: 0, notApp: 0, good: 0 }; if(obs.appropriateness === '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') aggC[obs.category][obs.subCategory].app++; if(obs.appropriateness === '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') aggC[obs.category][obs.subCategory].notApp++; if(obs.conditionAfter === '‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ') aggC[obs.category][obs.subCategory].good++; }); });
            for(let cat in aggC) { for(let sub in aggC[cat]) { tHtml += `<tr><td><b>${cat}</b></td><td>${sub}</td><td class="text-success fw-bold">${aggC[cat][sub].app}</td><td class="text-danger fw-bold">${aggC[cat][sub].notApp}</td><td class="text-primary fw-bold">${aggC[cat][sub].good}</td></tr>`; } }
            tBody.innerHTML = tHtml; 
        } else {
            tHead.innerHTML = `<tr><th>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (Area)</th><th>‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏ß‡∏° (‡∏£‡∏≤‡∏¢)</th><th>‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏°</th><th>‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏•‡πâ‡∏ß‡∏ô (‡∏£‡∏≤‡∏¢)</th><th>‡∏û‡∏ö‡∏à‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‡∏£‡∏≤‡∏¢)</th></tr>`;
            const agg = {}; let tHtml = '';
            filtered.forEach(d => { const key = d[dim] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'; if(!agg[key]) agg[key] = { count: 0, budget: 0, appUser: 0, notAppUser: 0 }; agg[key].count++; agg[key].budget += d.budget || 0; let hasNotApp = false; if(d.observations) hasNotApp = d.observations.some(o => o.appropriateness === '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°'); if(hasNotApp) agg[key].notAppUser++; else agg[key].appUser++; });
            for(let k in agg) { tHtml += `<tr><td><b>${k}</b></td><td>${agg[k].count}</td><td>${agg[k].budget.toLocaleString()}</td><td class="text-success fw-bold">${agg[k].appUser}</td><td class="text-danger fw-bold">${agg[k].notAppUser}</td></tr>`; }
            tBody.innerHTML = tHtml;
        }
      }
      document.getElementById('dashEmpty').style.display = 'none'; document.getElementById('dashResult').style.display = 'block';
    }

    window.exportSingleExcel = () => {
      const d = getFormData(); const g = d.general; const wb = XLSX.utils.book_new();
      const ws1_data = [ ["‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ (DOP 5-1.1)"], [], ["ID ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", g.recordId || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ID (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)"], ["‡∏≠‡∏õ‡∏ó.", `${g.localGov} ‡∏≠.${g.govDistrict} ‡∏à.${g.govProvince}`], ["‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå", `${g.inspector1} / ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°: ${g.inspector2}`], ["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà", `${formatDateBE(g.obsDate)} ‡πÄ‡∏ß‡∏•‡∏≤ ${g.timeStart} - ${g.timeEnd}`], [], ["‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏"], ["‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•", g.elderlyName], ["‡∏≠‡∏≤‡∏¢‡∏∏ / ‡πÄ‡∏û‡∏®", `${g.age} ‡∏õ‡∏µ / ${g.gender}`], ["‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà", `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${g.houseNo} ‡∏°.${g.moo} ‡∏ï.${g.subDistrict} ‡∏≠.${g.district} ‡∏à.${g.province}`], ["‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏®‡∏±‡∏¢ / ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•", `${g.livingStatus} / ${g.caregiver}`], ["‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ö‡πâ‡∏≤‡∏ô", g.houseType], ["‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ / ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤", `${g.elderlyIncome} ‡∏ö‡∏≤‡∏ó / ${g.incomeSource}`], [], ["‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢"], ["‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà", "‡∏™‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°", "‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á", "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"] ];
      d.observations.forEach(o => { ws1_data.push([`${o.category} - ${o.subCategory}`, o.currentState, o.appropriateness, o.conditionAfter, o.remark]); });
      const ws1 = XLSX.utils.aoa_to_sheet(ws1_data); XLSX.utils.book_append_sheet(wb, ws1, "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°");
      let fileName = `DOP5_Record_${g.localGov || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏õ‡∏ó'}_${g.elderlyName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}.xlsx`;
      XLSX.writeFile(wb, fileName);
    }
    
    window.exportPivotToExcel = () => {
       let html = document.getElementById("pivotTableExport").outerHTML;
       let url = 'data:application/vnd.ms-excel;charset=utf-8,%EF%BB%BF' + encodeURIComponent(html);
       let a = document.createElement('a'); a.href = url; a.download = 'DOP5_Dashboard_Pivot.xls'; a.click();
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
    window.addEventListener('DOMContentLoaded', () => {
      let html = ''; let currentCat = '';
      stdItems.forEach(item => { if (item.cat !== currentCat) { if(currentCat !== '') html += `</div>`; html += `<div class="p-3 mb-4 rounded shadow-sm group-cat-box"><h5 class="fw-bold text-success mb-3 pb-2" style="border-bottom: 2px solid var(--success);">${item.cat}</h5>`; currentCat = item.cat; } html += createObsHtml(item); });
      if(currentCat !== '') html += `</div>`;
      document.getElementById('observationContainer').innerHTML = html;
    });

  </script>
</body>
</html>
